
&НаКлиенте
Процедура Подбор(Команда)
		
	ОткрытьФорму("Справочник.РегиональныеКоэффициентыНИ.Форма.ФормаПодбораИзКлассификатора",, ЭтотОбъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаВыбора(РезультатВыбора, ИсточникВыбора)
	
	Элементы.Список.Обновить();
	Элементы.Список.ТекущаяСтрока = РезультатВыбора;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНаСервере()
	
	КлассификаторXML = Справочники.РегиональныеКоэффициентыНИ.ПолучитьМакет("РегиональныеКоэффициенты").ПолучитьТекст();
	
	КлассификаторТаблица = ОбщегоНазначения.ПрочитатьXMLВТаблицу(КлассификаторXML).Данные;
	
	Для Каждого ЗаписьОКВ Из КлассификаторТаблица Цикл
	
		Регион       = ЗаписьОКВ.Наименование;
		Коэффициент  = ЗаписьОКВ.Коэффициент; 
					
		ЗаписатьЭлементСправочника(Регион, Коэффициент);     	
		
	КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)
	Вопрос = "Справочник будет перезаполнен! Продолжить?";
	Ответ = Неопределено;

	ПоказатьВопрос(Новый ОписаниеОповещения("ЗаполнитьЗавершение", ЭтотОбъект), Вопрос, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Нет, );
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьЗавершение(РезультатВопроса, ДополнительныеПараметры) Экспорт
    
    Ответ  = РезультатВопроса;
    Если Ответ = КодВозвратаДиалога.Нет Тогда
        Возврат;
    КонецЕсли;
    
    ЗаполнитьНаСервере();
	
	Элементы.Список.Обновить();

КонецПроцедуры

// Записывает текущиц элемент классификатор с учетом
// иерархии 
&НаСервере  
Функция ЗаписатьЭлементСправочника(Регион, Коэффициент)	
	НайденнаяСсылка =  Справочники.РегиональныеКоэффициентыНИ.НайтиПоНаименованию(Регион);
	Если НайденнаяСсылка.Пустая() Тогда
		Объект = Справочники.РегиональныеКоэффициентыНИ.СоздатьЭлемент();
		Объект.Наименование = Регион;
		Объект.Коэффициент  = Коэффициент;
		Иначе
		Объект = НайденнаяСсылка.ПолучитьОбъект();
	КонецЕсли;	
	
	Объект.Наименование = Регион;
	
	Попытка
		Объект.Записать();
	Исключение
		Сообщить("Не удалось записать элемент: " + Регион + " "+  Коэффициент  + Символы.ПС + ОписаниеОшибки(), СтатусСообщения.Важное);
	КонецПопытки;
		
	Возврат Объект.Ссылка;
КонецФункции // ЗаписатьЭлементСправочника  

