
#Область ОбработчикиСобытийФормы

// Процедура - обработчик события ПриСозданииНаСервере.
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ОбновитьСписокЗадачБухгалтера();
	
КонецПроцедуры

// Процедура - обработчик события ПриЗакрытии.
//
&НаКлиенте
Процедура ПриЗакрытии(ЗавершениеРаботы)
	
	Оповестить("СписокЗадачБухгалтера_Изменение");	
	
КонецПроцедуры

// Процедура - обработчик события ОбработкаОповещения.
//
&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ОбновитьСписокЗадачБухгалтера" Тогда
		ОбновитьСписокЗадачБухгалтера();	
	КонецЕсли;	
		
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовТаблицыФормыТаблицаЗадач

// Процедура - обработчик события ПриИзменении таблицы ТаблицаЗадач.
//
&НаКлиенте
Процедура ТаблицаЗадачПриИзменении(Элемент)
	
	СтрокаТабличнойЧасти = Элементы.ТаблицаЗадач.ТекущиеДанные;
	
	СтруктураСтроки = Новый Структура();
	СтруктураСтроки.Вставить("Срок", 		СтрокаТабличнойЧасти.Срок);
	СтруктураСтроки.Вставить("Задача", 		СтрокаТабличнойЧасти.Задача);
	СтруктураСтроки.Вставить("ДатаПлана", 	СтрокаТабличнойЧасти.ДатаПлана);
	СтруктураСтроки.Вставить("Выполнено", 	СтрокаТабличнойЧасти.Выполнено);
	СтруктураСтроки.Вставить("Комментарий", СтрокаТабличнойЧасти.Комментарий);
	
	ТаблицаЗадачПриИзмененииНаСервере(СтруктураСтроки);	
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Процедура заполнения реквизита формы ТаблицаЗадач.
//
&НаСервере
Процедура ОбновитьСписокЗадачБухгалтера()
	ТаблицаЗадач.Загрузить(ОбщегоНазначенияБПСервер.ПолучитьСписокЗадачБухгалтера(Истина));	
КонецПроцедуры

// Процедура обновления/создания записей РС "ЗадачиБухгалтера".
//
&НаСервере
Процедура ТаблицаЗадачПриИзмененииНаСервере(СтруктураСтроки)
		
	НаборЗаписей = РегистрыСведений.СписокЗадачБухгалтера.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Срок.Установить(СтруктураСтроки.Срок);
	НаборЗаписей.Отбор.Задача.Установить(СтруктураСтроки.Задача);
	НаборЗаписей.Прочитать();
	
	Если НаборЗаписей.Количество() = 0 Тогда
		Запись = НаборЗаписей.Добавить();
	ИначеЕсли НаборЗаписей.Количество() = 1 Тогда
		Запись = НаборЗаписей[0];
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(Запись, СтруктураСтроки);
	
	НаборЗаписей.Записать();
КонецПроцедуры

#КонецОбласти
