#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПроцедурыПроведенияДокумента

Процедура СформироватьТаблицаХозрасчетный(ДокументСсылка, СтруктураДополнительныеСвойства)
	
		
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДвиженияМБП.Период,
		|	ДвиженияМБП.Организация,
		|	ДвиженияМБП.СчетКт,
		|	ДвиженияМБП.СубконтоКт1,
		|	ДвиженияМБП.СубконтоКт2,
		|	ДвиженияМБП.СубконтоКт3,
		|	ДвиженияМБП.КоличествоКт,
		|	ДвиженияМБП.СчетДт,
		|	ДвиженияМБП.СубконтоДт1,
		|	ДвиженияМБП.СубконтоДт2,
		|	ДвиженияМБП.СубконтоДт3,
		|	ДвиженияМБП.КоличествоДт,
		|	ДвиженияМБП.Сумма,
		|	ДвиженияМБП.Содержание,
		|	ДвиженияМБП.ВалютаДт,
		|	ДвиженияМБП.ВалютаКт,
		|	ДвиженияМБП.ВалютнаяСуммаДт,
		|	ДвиженияМБП.ВалютнаяСуммаКт
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП) КАК СчетКт,
		|		ВременнаяТаблицаТовары.Номенклатура КАК СубконтоКт1,
		|		ВременнаяТаблицаШапка.Склад КАК СубконтоКт2,
		|		ВременнаяТаблицаТовары.предСтатус КАК СубконтоКт3,
		|		СУММА(ВременнаяТаблицаТовары.Количество) КАК КоличествоКт,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП) КАК СчетДт,
		|		ВременнаяТаблицаТовары.Номенклатура КАК СубконтоДт1,
		|		ВременнаяТаблицаШапка.Физлицо КАК СубконтоДт2,
		|		ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Эксплуатация) КАК СубконтоДт3,
		|		СУММА(ВременнаяТаблицаТовары.Количество) КАК КоличествоДт,
		|		СУММА(ВременнаяТаблицаТовары.Сумма) КАК Сумма,
		|		""Движение МБП - ввод  в эксплуатацию"" КАК Содержание,
		|		NULL КАК ВалютаДт,
		|		NULL КАК ВалютаКт,
		|		NULL КАК ВалютнаяСуммаДт,
		|		NULL КАК ВалютнаяСуммаКт
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция),
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		0,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаРеставрация.Номенклатура,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.РеставрацияСоСклада
		|				ТОГДА ВременнаяТаблицаШапка.Склад
		|			ИНАЧЕ ВременнаяТаблицаШапка.Физлицо
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.РеставрацияСоСклада
		|				ТОГДА ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Склад)
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Эксплуатация)
		|		КОНЕЦ,
		|		СУММА(ВременнаяТаблицаРеставрация.Количество),
		|		СУММА(ВременнаяТаблицаРеставрация.Сумма),
		|		""Движение МБП - ввод в эксплуатацию после реставрации"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаРеставрация КАК ВременнаяТаблицаРеставрация
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаРеставрация.предСтатус,
		|		ВременнаяТаблицаРеставрация.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаШапка.РеставрацияСоСклада
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Эксплуатация),
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Склад),
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Движение МБП - возврат из эксплуатации"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВозвратНаСклад)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Движение МБП - перемещение со склада на склад"",
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		0,
		|		0
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.ПредСтатус
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.ФизлицоПолучатель,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Движение МБП - передача от МОЛ к другому МОЛ"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаШапка.ФизлицоПолучатель,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.ПредСтатус
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.Номенклатура
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаШапка.Физлицо
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.ПредСтатус
		|		КОНЕЦ,
		|		СУММА(ВЫБОР
		|				КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|					ТОГДА 0
		|				ИНАЧЕ ВременнаяТаблицаТовары.Количество
		|			КОНЕЦ),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Движение МБП - списание из эксплуатации"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|				ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|					И НЕ ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.Номенклатура
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаШапка.Физлицо
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.ПредСтатус
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.Подразделение,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|				ТОГДА ВременнаяТаблицаШапка.Физлицо
		|			ИНАЧЕ ВременнаяТаблицаШапка.Подразделение
		|		КОНЕЦ,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.ПредСтатус
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.ПредСтатус,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА 0
		|			ИНАЧЕ СУММА(ВременнаяТаблицаТовары.Количество)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция)
		|			ИНАЧЕ ВременнаяТаблицаШапка.СчетЗатрат
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаШапка.СтатьяЗатрат
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаШапка.Подразделение
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.Номенклатура
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА 0
		|			ИНАЧЕ СУММА(ВременнаяТаблицаТовары.Количество)
		|		КОНЕЦ,
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Движение МБП - списание со склада"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаНоменклатуры КАК СчетаУчетаНоменклатуры
		|			ПО (ВЫБОР
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ВременнаяТаблицаТовары.Номенклатура = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|				КОНЕЦ)
		|	ГДЕ
		|		(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|				ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|					И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.СчетЗатрат,
		|		ВременнаяТаблицаШапка.СтатьяЗатрат,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаШапка.Подразделение
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				ТОГДА НЕОПРЕДЕЛЕНО
		|			ИНАЧЕ ВременнаяТаблицаТовары.Номенклатура
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.ВидОперации,
		|		ВременнаяТаблицаТовары.ПредСтатус
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Эксплуатация),
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Перемещение ТМЗ на МБП В Эксплуатации"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		НЕОПРЕДЕЛЕНО,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Перемещение ТМЗ на МБП"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБП)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Склад,
		|		НЕОПРЕДЕЛЕНО,
		|		СУММА(ВременнаяТаблицаТовары.Количество),
		|		СУММА(ВременнаяТаблицаТовары.Сумма),
		|		""Перемещение ТМЗ на МБП"",
		|		NULL,
		|		NULL,
		|		NULL,
		|		NULL
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПНаТовары)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаТовары.предСтатус,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.СчетУчетаТоваров,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура) КАК ДвиженияМБП
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	АмортизацияМБП.Период,
		|	АмортизацияМБП.Организация,
		|	АмортизацияМБП.СчетКт,
		|	АмортизацияМБП.СубконтоКт1,
		|	АмортизацияМБП.СубконтоКт2,
		|	АмортизацияМБП.СубконтоКт3,
		|	СУММА(АмортизацияМБП.КоличествоКт),
		|	АмортизацияМБП.СчетДт,
		|	АмортизацияМБП.СУбконтоДт1,
		|	АмортизацияМБП.СубконтоДт2,
		|	АмортизацияМБП.СубконтоДт3,
		|	СУММА(АмортизацияМБП.КоличествоДт),
		|	СУММА(АмортизацияМБП.Сумма),
		|	АмортизацияМБП.Содержание,
		|	NULL,
		|	NULL,
		|	NULL,
		|	NULL
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП) КАК СчетКт,
		|		ВременнаяТаблицаТовары.Номенклатура КАК СубконтоКт1,
		|		НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
		|		НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
		|		ВременнаяТаблицаТовары.Количество КАК КоличествоКт,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.СчетЗатрат = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
		|				ТОГДА СчетаУчетаНоменклатуры.СчетРасхода
		|			ИНАЧЕ ВременнаяТаблицаШапка.СчетЗатрат
		|		КОНЕЦ КАК СчетДт,
		|		ВременнаяТаблицаШапка.СтатьяЗатратМБП КАК СУбконтоДт1,
		|		НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
		|		НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
		|		ВременнаяТаблицаТовары.Количество КАК КоличествоДт,
		|		ВременнаяТаблицаТовары.Сумма КАК Сумма,
		|		ВЫБОР
		|			КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации))
		|					И УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПриВводе)
		|				ТОГДА ""Износ МБП - 100% при вводе в эксплуатацию""
		|			ИНАЧЕ """"
		|		КОНЕЦ КАК Содержание
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций.СрезПоследних(
		|					&Период,
		|					Организация В
		|						(ВЫБРАТЬ
		|							ВременнаяТаблицаШапка.Организация
		|						ИЗ
		|							ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка)) КАК УчетнаяПолитикаОрганизацийСрезПоследних
		|			ПО (ИСТИНА)
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаНоменклатуры КАК СчетаУчетаНоменклатуры
		|			ПО (ВЫБОР
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ВременнаяТаблицаТовары.Номенклатура = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|				КОНЕЦ)
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|						ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации))
		|						И ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|					ТОГДА УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПриВводе)
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.СчетЗатрат = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
		|				ТОГДА СчетаУчетаНоменклатуры.СчетРасхода
		|			ИНАЧЕ ВременнаяТаблицаШапка.СчетЗатрат
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.СтатьяЗатратМБП,
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВременнаяТаблицаТовары.Сумма / 2,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|					И УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПриВводе)
		|				ТОГДА ""Износ МБП - 50% при вводе в эксплуатацию""
		|			ИНАЧЕ """"
		|		КОНЕЦ
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций.СрезПоследних(
		|					&Период,
		|					Организация В
		|						(ВЫБРАТЬ
		|							ВременнаяТаблицаШапка.Организация
		|						ИЗ
		|							ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка)) КАК УчетнаяПолитикаОрганизацийСрезПоследних
		|			ПО (ИСТИНА)
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаНоменклатуры КАК СчетаУчетаНоменклатуры
		|			ПО (ВЫБОР
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ВременнаяТаблицаТовары.Номенклатура = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|				КОНЕЦ)
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|						И ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|					ТОГДА УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПоловинуПриВводе)
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|				ТОГДА ВременнаяТаблицаШапка.Физлицо
		|			ИНАЧЕ ВременнаяТаблицаШапка.Подразделение
		|		КОНЕЦ,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.СчетЗатрат = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
		|				ТОГДА СчетаУчетаНоменклатуры.СчетРасхода
		|			ИНАЧЕ ВременнаяТаблицаШапка.СчетЗатрат
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.СтатьяЗатратМБП,
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВременнаяТаблицаТовары.Сумма,
		|		ВЫБОР
		|			КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|						И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|					И УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПриСписании)
		|					И НЕ ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|				ТОГДА ""Износ МБП - 100% при списании""
		|			ИНАЧЕ """"
		|		КОНЕЦ
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций.СрезПоследних(
		|					&Период,
		|					Организация В
		|						(ВЫБРАТЬ
		|							ВременнаяТаблицаШапка.Организация
		|						ИЗ
		|							ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка)) КАК УчетнаяПолитикаОрганизацийСрезПоследних
		|			ПО (ИСТИНА)
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаНоменклатуры КАК СчетаУчетаНоменклатуры
		|			ПО (ВЫБОР
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ВременнаяТаблицаТовары.Номенклатура = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|				КОНЕЦ)
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|						ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|						ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|							И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|						И НЕ ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|					ТОГДА УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПриСписании)
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Организация,
		|		ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НачисленныйИзносМБП),
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|				ТОГДА ВременнаяТаблицаШапка.Физлицо
		|			ИНАЧЕ ВременнаяТаблицаШапка.Подразделение
		|		КОНЕЦ,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.СчетЗатрат = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
		|				ТОГДА СчетаУчетаНоменклатуры.СчетРасхода
		|			ИНАЧЕ ВременнаяТаблицаШапка.СчетЗатрат
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.СтатьяЗатратМБП,
		|		НЕОПРЕДЕЛЕНО,
		|		НЕОПРЕДЕЛЕНО,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВременнаяТаблицаТовары.Сумма / 2,
		|		ВЫБОР
		|			КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|					ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|						И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|					И УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПоловинуПриВводе)
		|					И НЕ ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|				ТОГДА ""Износ МБП - 50% при списании""
		|			ИНАЧЕ """"
		|		КОНЕЦ
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций.СрезПоследних(
		|					&Период,
		|					Организация В
		|						(ВЫБРАТЬ
		|							ВременнаяТаблицаШапка.Организация
		|						ИЗ
		|							ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка)) КАК УчетнаяПолитикаОрганизацийСрезПоследних
		|			ПО (ИСТИНА)
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаНоменклатуры КАК СчетаУчетаНоменклатуры
		|			ПО (ВЫБОР
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ВременнаяТаблицаТовары.Номенклатура = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ВременнаяТаблицаШапка.Склад = СчетаУчетаНоменклатуры.Склад
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					КОГДА ВременнаяТаблицаШапка.Организация = СчетаУчетаНоменклатуры.Организация
		|							И ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|						ТОГДА ИСТИНА
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.МБП) = СчетаУчетаНоменклатуры.Номенклатура
		|				КОНЕЦ)
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА (ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|						ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|						ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|							И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|						И НЕ ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Новый)
		|					ТОГДА УчетнаяПолитикаОрганизацийСрезПоследних.ВидУчетаИзносаМБП = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаИзносаМБП.ПоловинуПриВВоде)
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ) КАК АмортизацияМБП
		|
		|СГРУППИРОВАТЬ ПО
		|	АмортизацияМБП.Период,
		|	АмортизацияМБП.Организация,
		|	АмортизацияМБП.СчетКт,
		|	АмортизацияМБП.СубконтоКт1,
		|	АмортизацияМБП.СубконтоКт2,
		|	АмортизацияМБП.СубконтоКт3,
		|	АмортизацияМБП.СчетДт,
		|	АмортизацияМБП.СУбконтоДт1,
		|	АмортизацияМБП.СубконтоДт2,
		|	АмортизацияМБП.СубконтоДт3,
		|	АмортизацияМБП.Содержание";
		Запрос.УстановитьПараметр("Период", ДокументСсылка.МоментВремени());
	
	РезультатЗапроса = Запрос.Выполнить();
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаХозрасчетный", РезультатЗапроса.Выгрузить());
	
КонецПроцедуры

Процедура СформироватьТаблицаЗапасы(ДокументСсылка, СтруктураДополнительныеСвойства) 
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВременнаяТаблицаШапка.Дата КАК Период,
	|	ВременнаяТаблицаШапка.Организация,
	|	ВременнаяТаблицаТовары.СчетУчетаТоваров КАК СчетУчета,
	|	ВременнаяТаблицаШапка.Склад,
	|	ВременнаяТаблицаТовары.Номенклатура,
	|	ВременнаяТаблицаТовары.Партия КАК Партия,
	|	ВременнаяТаблицаТовары.Количество,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
	|	ВременнаяТаблицаТовары.Цена КАК Цена,
	|	ВременнаяТаблицаТовары.Сумма КАК Сумма
	|ИЗ
	|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
	|		ПО (ИСТИНА)
	|ГДЕ
	|	(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации)
	|			ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБП))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВременнаяТаблицаШапка.Дата,
	|	ВременнаяТаблицаШапка.Организация,
	|	ВременнаяТаблицаТовары.СчетУчетаТоваров,
	|	ВременнаяТаблицаШапка.Склад,
	|	ВременнаяТаблицаТовары.Номенклатура,
	|	ВременнаяТаблицаТовары.Партия,
	|	ВременнаяТаблицаТовары.Количество,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход),
	|	ВременнаяТаблицаТовары.Цена,
	|	ВременнаяТаблицаТовары.Сумма
	|ИЗ
	|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
	|		ПО (ИСТИНА)
	|ГДЕ
	|	ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПНаТовары)";
	
	РезультатЗапроса = Запрос.Выполнить();
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаЗапасы", РезультатЗапроса.Выгрузить());
		
КонецПроцедуры 

Процедура Ввод_СформироватьТаблицаМБПСклад(ДокументСсылка, СтруктураДополнительныеСвойства)
	
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДвижениеМБППеремещение.Период,
		|	ДвижениеМБППеремещение.ВидДвижения,
		|	ДвижениеМБППеремещение.Организация,
		|	ДвижениеМБППеремещение.Склад,
		|	ДвижениеМБППеремещение.Номенклатура,
		|	ДвижениеМБППеремещение.Партия,
		|	ДвижениеМБППеремещение.ИнвНомер,
		|	ДвижениеМБППеремещение.Количество,
		|	ДвижениеМБППеремещение.Сумма,
		|	ДвижениеМБППеремещение.Статус
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ВременнаяТаблицаШапка.Склад КАК Склад,
		|		ВременнаяТаблицаТовары.Номенклатура КАК Номенклатура,
		|		ВременнаяТаблицаТовары.Партия КАК Партия,
		|		ВременнаяТаблицаТовары.ИндивидуальныйНомер КАК ИнвНомер,
		|		ВременнаяТаблицаТовары.Количество КАК Количество,
		|		ВременнаяТаблицаТовары.Сумма КАК Сумма,
		|		ВременнаяТаблицаТовары.предСтатус КАК Статус
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|				ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПНаТовары))
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход),
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.СкладПолучатель,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.Партия,
		|		ВременнаяТаблицаТовары.ИндивидуальныйНомер,
		|		ВременнаяТаблицаТовары.Количество,
		|		ВременнаяТаблицаТовары.Сумма,
		|		ВременнаяТаблицаТовары.предСтатус
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)) КАК ДвижениеМБППеремещение
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДвижениеМБП.Период,
		|	ДвижениеМБП.ВидДвижения,
		|	ДвижениеМБП.Организация,
		|	ДвижениеМБП.Склад,
		|	ДвижениеМБП.Номенклатура,
		|	ДвижениеМБП.Партия,
		|	ДвижениеМБП.ИнвНомер,
		|	ДвижениеМБП.Количество,
		|	ДвижениеМБП.Сумма,
		|	ДвижениеМБП.Статус
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		КОНЕЦ КАК ВидДвижения,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ВременнаяТаблицаШапка.Склад КАК Склад,
		|		ВременнаяТаблицаТовары.Номенклатура КАК Номенклатура,
		|		ВременнаяТаблицаТовары.Партия КАК Партия,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(перечисление.СтатусыМБП.Новый)
		|				ТОГДА """"
		|			ИНАЧЕ ВременнаяТаблицаТовары.ИндивидуальныйНомер
		|		КОНЕЦ КАК ИнвНомер,
		|		СУММА(ВременнаяТаблицаТовары.Количество) КАК Количество,
		|		СУММА(ВременнаяТаблицаТовары.Сумма) КАК Сумма,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ВременнаяТаблицаТовары.предСтатус
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Склад)
		|		КОНЕЦ КАК Статус
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПНаТовары)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаТовары.Партия,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ВременнаяТаблицаТовары.предСтатус
		|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СтатусыМБП.Склад)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаТовары.предСтатус = ЗНАЧЕНИЕ(перечисление.СтатусыМБП.Новый)
		|				ТОГДА """"
		|			ИНАЧЕ ВременнаяТаблицаТовары.ИндивидуальныйНомер
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		КОНЕЦ) КАК ДвижениеМБП
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДвижениеМБПСписание.Период,
		|	ДвижениеМБПСписание.ВидДвижения,
		|	ДвижениеМБПСписание.Организация,
		|	ДвижениеМБПСписание.Склад,
		|	ДвижениеМБПСписание.Номенклатура,
		|	ДвижениеМБПСписание.Партия,
		|	ДвижениеМБПСписание.ИнвНомер,
		|	ДвижениеМБПСписание.Количество,
		|	ДвижениеМБПСписание.Сумма,
		|	ДвижениеМБПСписание.Статус
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ВременнаяТаблицаШапка.Склад КАК Склад,
		|		ВременнаяТаблицаТовары.Номенклатура КАК Номенклатура,
		|		ВременнаяТаблицаТовары.Партия КАК Партия,
		|		ВременнаяТаблицаТовары.ИндивидуальныйНомер КАК ИнвНомер,
		|		СУММА(ВременнаяТаблицаТовары.Количество) КАК Количество,
		|		СУММА(ВременнаяТаблицаТовары.Сумма) КАК Сумма,
		|		ВременнаяТаблицаТовары.предСтатус КАК Статус
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|	ГДЕ
		|		(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|				ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|					И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаТовары.Партия,
		|		ВременнаяТаблицаТовары.ИндивидуальныйНомер,
		|		ВременнаяТаблицаТовары.предСтатус) КАК ДвижениеМБПСписание
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДвижениеМБППриходРеставрация.Период,
		|	ДвижениеМБППриходРеставрация.ВидДвижения,
		|	ДвижениеМБППриходРеставрация.Организация,
		|	ДвижениеМБППриходРеставрация.Склад,
		|	ДвижениеМБППриходРеставрация.Номенклатура,
		|	ДвижениеМБППриходРеставрация.Партия,
		|	0,
		|	ДвижениеМБППриходРеставрация.Количество,
		|	ДвижениеМБППриходРеставрация.Сумма,
		|	ДвижениеМБППриходРеставрация.Статус
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ВременнаяТаблицаШапка.Склад КАК Склад,
		|		ВременнаяТаблицаРеставрация.Номенклатура КАК Номенклатура,
		|		ВременнаяТаблицаШапка.Ссылка КАК Партия,
		|		СУММА(ВременнаяТаблицаРеставрация.Количество) КАК Количество,
		|		СУММА(ВременнаяТаблицаРеставрация.Сумма) КАК Сумма,
		|		ВременнаяТаблицаРеставрация.предСтатус КАК Статус
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|		ВременнаяТаблицаРеставрация КАК ВременнаяТаблицаРеставрация
		|	ГДЕ
		|		(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|				ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|					И ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВременнаяТаблицаШапка.Ссылка,
		|		ВременнаяТаблицаШапка.Дата,
		|		ВременнаяТаблицаШапка.Склад,
		|		ВременнаяТаблицаРеставрация.Номенклатура,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаРеставрация.предСтатус) КАК ДвижениеМБППриходРеставрация";
	РезультатЗапроса = Запрос.Выполнить();
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаМБПСклад", РезультатЗапроса.Выгрузить());

КонецПроцедуры

Процедура Ввод_СформироватьТаблицаМБПЭксплуатация(ДокументСсылка, СтруктураДополнительныеСвойства)
	
	Если  ДокументСсылка.ВидОперации = Перечисления.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию Тогда 	
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДвижениеМБП.Организация,
		|	ДвижениеМБП.Номенклатура,
		|	ДвижениеМБП.Партия,
		|	ДвижениеМБП.Количество,
		|	ДвижениеМБП.Сумма КАК Сумма,
		|	ДвижениеМБП.Период КАК Период,
		|	ДвижениеМБП.ВидДвижения КАК ВидДвижения,
		|	ДвижениеМБП.МОЛ КАК МОЛ,
		|	ДвижениеМБП.ИнвНомер КАК ИнвНомер,
		|	ДвижениеМБП.Статус КАК Статус,
		|	ДвижениеМБП.Период КАК ДатаВыдачи
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата КАК Период,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		КОНЕЦ КАК ВидДвижения,
		|		ВременнаяТаблицаШапка.Организация КАК Организация,
		|		ВременнаяТаблицаШапка.Физлицо КАК МОЛ,
		|		ВременнаяТаблицаТовары.Номенклатура КАК Номенклатура,
		|		ВременнаяТаблицаТовары.Партия КАК Партия,
		|		ВременнаяТаблицаТовары.ИндивидуальныйНомер КАК ИнвНомер,
		|		ВременнаяТаблицаТовары.Количество КАК Количество,
		|		ВременнаяТаблицаТовары.Сумма КАК Сумма,
		|		ЗНАЧЕНИЕ(перечисление.СтатусыМБП.Эксплуатация) КАК Статус,
		|		ВременнаяТаблицаТовары.цена КАК цена
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|			ПО (ИСТИНА)
		|	ГДЕ
		|		НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|		И НЕ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВременнаяТаблицаШапка.Дата,
		|		ВЫБОР
		|			КОГДА ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|				ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		КОНЕЦ,
		|		ВременнаяТаблицаШапка.Организация,
		|		ВременнаяТаблицаШапка.Физлицо,
		|		ВременнаяТаблицаТовары.Номенклатура,
		|		ВременнаяТаблицаТовары.Партия,
		|		ВТНомераМБП.НомерМБП,
		|		1,
		|		ВременнаяТаблицаТовары.Сумма,
		|		ЗНАЧЕНИЕ(перечисление.СтатусыМБП.Эксплуатация),
		|		ВременнаяТаблицаТовары.цена
		|	ИЗ
		|		ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНомераМБП КАК ВТНомераМБП
		|				ПО ВременнаяТаблицаТовары.Номенклатура = ВТНомераМБП.Номенклатура
		|					И ВременнаяТаблицаТовары.Партия = ВТНомераМБП.Партия
		|					И ВременнаяТаблицаТовары.НомерСтроки = ВТНомераМБП.СтрокаТЧ
		|			ПО (ИСТИНА)
		|	ГДЕ
		|		ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|		ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|		ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|		ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)) КАК ДвижениеМБП";
	Иначе 
		
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ВременнаяТаблицаШапка.Организация КАК Организация,
		|	ВременнаяТаблицаТовары.Номенклатура КАК Номенклатура,
		|	ВременнаяТаблицаТовары.Партия КАК Партия,
		|	ВременнаяТаблицаТовары.Количество КАК Количество,
		|	ВременнаяТаблицаТовары.Сумма КАК Сумма,
		|	ВременнаяТаблицаШапка.Дата КАК Период,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ВременнаяТаблицаШапка.Физлицо КАК МОЛ,
		|	ВременнаяТаблицаТовары.ИндивидуальныйНомер КАК ИнвНомер,
		|	ВременнаяТаблицаТовары.предСтатус КАК Статус,
		|	ВременнаяТаблицаТовары.ДатаВыдачи КАК ДатаВыдачи
		|ИЗ
		|	ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|ГДЕ
		|	ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВременнаяТаблицаШапка.Организация,
		|	ВременнаяТаблицаТовары.Номенклатура,
		|	ВременнаяТаблицаТовары.Партия,
		|	ВременнаяТаблицаТовары.Количество,
		|	ВременнаяТаблицаТовары.Сумма,
		|	ВременнаяТаблицаШапка.Дата,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход),
		|	ВременнаяТаблицаШапка.ФизлицоПолучатель,
		|	ВременнаяТаблицаТовары.ИндивидуальныйНомер,
		|	ВременнаяТаблицаТовары.предСтатус,
		|	ВременнаяТаблицаШапка.Дата
		|ИЗ
		|	ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|ГДЕ
		|	(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|			И ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеТоваровНаМБПВЭксплуатации))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВременнаяТаблицаШапка.Организация,
		|	ВременнаяТаблицаТовары.Номенклатура,
		|	ВременнаяТаблицаТовары.Партия,
		|	ВременнаяТаблицаТовары.Количество,
		|	ВременнаяТаблицаТовары.Сумма,
		|	ВременнаяТаблицаШапка.Дата,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход),
		|	ВременнаяТаблицаШапка.Физлицо,
		|	ВременнаяТаблицаТовары.ИндивидуальныйНомер,
		|	ВременнаяТаблицаТовары.предСтатус,
		|	ВременнаяТаблицаТовары.ДатаВыдачи
		|ИЗ
		|	ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|ГДЕ
		|	(ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|			ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВозвратНаСклад)
		|			ИЛИ ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|				И НЕ ВременнаяТаблицаШапка.РеставрацияСоСклада)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВременнаяТаблицаШапка.Организация,
		|	ВременнаяТаблицаРеставрация.Номенклатура,
		|	ВременнаяТаблицаШапка.Ссылка,
		|	ВременнаяТаблицаРеставрация.Количество,
		|	ВременнаяТаблицаРеставрация.Сумма,
		|	ВременнаяТаблицаШапка.Дата,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход),
		|	ВременнаяТаблицаШапка.Физлицо,
		|	0,
		|	ВременнаяТаблицаРеставрация.предСтатус,
		|	NULL
		|ИЗ
		|	ВременнаяТаблицаШапка КАК ВременнаяТаблицаШапка,
		|	ВременнаяТаблицаРеставрация КАК ВременнаяТаблицаРеставрация
		|ГДЕ
		|	ВременнаяТаблицаШапка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|	И НЕ ВременнаяТаблицаШапка.РеставрацияСоСклада";
							
	КонецЕсли;
	РезультатЗапроса = Запрос.Выполнить();
	
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаМБПЭксплуатация", РезультатЗапроса.Выгрузить());
	
КонецПроцедуры

// Инициализирует таблицы значений, содержащие данные табличных частей документа.
// Таблицы значений сохраняет в свойствах структуры "ДополнительныеСвойства".
//
Процедура ИнициализироватьДанныеДокумента(ДокументСсылка, СтруктураДополнительныеСвойства) Экспорт
	//Если ДокументСсылка.ВидОперации = Перечисления.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию Тогда 
	
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДвижениеМБП.Ссылка,
		|	ДвижениеМБП.Номер,
		|	ДвижениеМБП.Дата,
		|	ДвижениеМБП.Организация,
		|	ДвижениеМБП.ФизЛицо,
		|	СотрудникиСрезПоследних.Подразделение,
		|	ДвижениеМБП.ВидОперации,
		|	ДвижениеМБП.Склад,
		|	СотрудникиСрезПоследних_Получатель.Подразделение КАК ПодразделениеПолучатель,
		|	ДвижениеМБП.ФизЛицоПолучатель,
		|	ДвижениеМБП.СкладПолучатель,
		|	&СтатьяЗатратМБП,
		|	ДвижениеМБП.СтатьяЗатрат,
		|	ДвижениеМБП.СчетЗатрат,
		|	ВЫБОР
		|		КОГДА ДвижениеМБП.РеставрацияСоСклада = 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК РеставрацияСоСклада
		|ПОМЕСТИТЬ ВременнаяТаблицаШапка
		|ИЗ
		|	Документ.ДвижениеМБП КАК ДвижениеМБП
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Сотрудники.СрезПоследних(
		|				&Дата,
		|				ФизЛицо = &ФизЛицо
		|					И Организация = &Организация) КАК СотрудникиСрезПоследних
		|		ПО ДвижениеМБП.ФизЛицо = СотрудникиСрезПоследних.ФизЛицо
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Сотрудники.СрезПоследних(
		|				&Дата,
		|				ФизЛицо = &ФизЛицоПолучатель
		|					И Организация = &Организация) КАК СотрудникиСрезПоследних_Получатель
		|		ПО ДвижениеМБП.ФизЛицоПолучатель = СотрудникиСрезПоследних_Получатель.ФизЛицо
		|ГДЕ
		|	ДвижениеМБП.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДвижениеМБПТовары.Ссылка,
		|	ДвижениеМБПТовары.НомерСтроки,
		|	ДвижениеМБПТовары.Номенклатура,
		|	ДвижениеМБПТовары.Партия,
		|	ДвижениеМБПТовары.ИндивидуальныйНомер,
		|	ДвижениеМБПТовары.ДатаВыдачи,
		|	СУММА(ДвижениеМБПТовары.Количество) КАК Количество,
		|	СУММА(ДвижениеМБПТовары.Сумма) КАК Сумма,
		|	ДвижениеМБПТовары.предСтатусМБП КАК предСтатус,
		|	ДвижениеМБПТовары.ИндивидуальныйНомерКонец,
		|	ДвижениеМБПТовары.ПоНомерам,
		|	ДвижениеМБПТовары.Цена,
		|	ДвижениеМБПТовары.СчетУчетаТоваров
		|ПОМЕСТИТЬ ВременнаяТаблицаТоварыНачало
		|ИЗ
		|	Документ.ДвижениеМБП.Товары КАК ДвижениеМБПТовары
		|ГДЕ
		|	ДвижениеМБПТовары.Ссылка = &Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ДвижениеМБПТовары.ИндивидуальныйНомер,
		|	ДвижениеМБПТовары.Номенклатура,
		|	ДвижениеМБПТовары.предСтатусМБП,
		|	ДвижениеМБПТовары.Партия,
		|	ДвижениеМБПТовары.Ссылка,
		|	ДвижениеМБПТовары.ИндивидуальныйНомерКонец,
		|	ДвижениеМБПТовары.ПоНомерам,
		|	ДвижениеМБПТовары.НомерСтроки,
		|	ДвижениеМБПТовары.Цена,
		|	ДвижениеМБПТовары.ДатаВыдачи,
		|	ДвижениеМБПТовары.СчетУчетаТоваров
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВременнаяТаблицаТоварыНачало.Номенклатура,
		|	ВременнаяТаблицаТоварыНачало.Партия,
		|	ВременнаяТаблицаТоварыНачало.ИндивидуальныйНомер,
		|	ВременнаяТаблицаТоварыНачало.ДатаВыдачи,
		|	СУММА(ВременнаяТаблицаТоварыНачало.Количество) КАК Количество,
		|	СУММА(ВЫБОР
		|			КОГДА &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБП)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеСоСклада)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|						И &РеставрацияСоСклада
		|				ТОГДА ВЫБОР
		|						КОГДА ВременнаяТаблицаТоварыНачало.Количество > МБПСкладОстатки.КоличествоОстаток
		|							ТОГДА МБПСкладОстатки.СуммаОстаток
		|						ИНАЧЕ ВременнаяТаблицаТоварыНачало.Сумма
		|					КОНЕЦ
		|			КОГДА &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ВозвратНаСклад)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.ПеремещениеМБПВЭксплуатации)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.СписаниеИзЭксплуатации)
		|					ИЛИ &ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДвижениеМБП.Реставрация)
		|						И НЕ &РеставрацияСоСклада
		|				ТОГДА ВЫБОР
		|						КОГДА ВременнаяТаблицаТоварыНачало.Количество > МБПЭксплуатацияОстатки.КоличествоОстаток
		|							ТОГДА МБПЭксплуатацияОстатки.СуммаОстаток
		|						ИНАЧЕ ВременнаяТаблицаТоварыНачало.Сумма
		|					КОНЕЦ
		|			ИНАЧЕ ВременнаяТаблицаТоварыНачало.Сумма
		|		КОНЕЦ) КАК Сумма,
		|	ВременнаяТаблицаТоварыНачало.ИндивидуальныйНомерКонец,
		|	ВременнаяТаблицаТоварыНачало.ПоНомерам,
		|	ВременнаяТаблицаТоварыНачало.Цена,
		|	ВременнаяТаблицаТоварыНачало.предСтатус,
		|	ВременнаяТаблицаТоварыНачало.Ссылка,
		|	ВременнаяТаблицаТоварыНачало.НомерСтроки,
		|	ВременнаяТаблицаТоварыНачало.СчетУчетаТоваров
		|ПОМЕСТИТЬ ВременнаяТаблицаТовары
		|ИЗ
		|	ВременнаяТаблицаТоварыНачало КАК ВременнаяТаблицаТоварыНачало
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.МБПЭксплуатация.Остатки(&Дата, МОЛ = &ФизЛицо) КАК МБПЭксплуатацияОстатки
		|		ПО ВременнаяТаблицаТоварыНачало.Номенклатура = МБПЭксплуатацияОстатки.Номенклатура
		|			И ВременнаяТаблицаТоварыНачало.Партия = МБПЭксплуатацияОстатки.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.МБПСклад.Остатки(&Дата, Склад = &Склад) КАК МБПСкладОстатки
		|		ПО ВременнаяТаблицаТоварыНачало.Номенклатура = МБПСкладОстатки.Номенклатура
		|			И ВременнаяТаблицаТоварыНачало.Партия = МБПСкладОстатки.Партия
		|
		|СГРУППИРОВАТЬ ПО
		|	ВременнаяТаблицаТоварыНачало.ИндивидуальныйНомер,
		|	ВременнаяТаблицаТоварыНачало.Номенклатура,
		|	ВременнаяТаблицаТоварыНачало.Партия,
		|	ВременнаяТаблицаТоварыНачало.ИндивидуальныйНомерКонец,
		|	ВременнаяТаблицаТоварыНачало.ПоНомерам,
		|	ВременнаяТаблицаТоварыНачало.Цена,
		|	ВременнаяТаблицаТоварыНачало.ДатаВыдачи,
		|	ВременнаяТаблицаТоварыНачало.предСтатус,
		|	ВременнаяТаблицаТоварыНачало.Ссылка,
		|	ВременнаяТаблицаТоварыНачало.НомерСтроки,
		|	ВременнаяТаблицаТоварыНачало.СчетУчетаТоваров
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДвижениеМБПРеставрация.Ссылка,
		|	ДвижениеМБПРеставрация.Количество,
		|	ДвижениеМБПРеставрация.НомерСтрокиМБП,
		|	ДвижениеМБПРеставрация.МБП,
		|	ДвижениеМБПРеставрация.Номенклатура,
		|	СУММА(ДвижениеМБПРеставрация.Сумма) КАК Сумма,
		|	СУММА(ДвижениеМБПРеставрация.Цена) КАК Цена,
		|	ДвижениеМБПРеставрация.предСтатусМБП КАК предСтатус
		|ПОМЕСТИТЬ ВременнаяТаблицаРеставрация
		|ИЗ
		|	Документ.ДвижениеМБП.Реставрация КАК ДвижениеМБПРеставрация
		|ГДЕ
		|	ДвижениеМБПРеставрация.Ссылка = &Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ДвижениеМБПРеставрация.Ссылка,
		|	ДвижениеМБПРеставрация.МБП,
		|	ДвижениеМБПРеставрация.Номенклатура,
		|	ДвижениеМБПРеставрация.Количество,
		|	ДвижениеМБПРеставрация.НомерСтрокиМБП,
		|	ДвижениеМБПРеставрация.предСтатусМБП";
		
		Запрос.УстановитьПараметр("Ссылка", 	ДокументСсылка);
		Запрос.УстановитьПараметр("Дата", 		ДокументСсылка.Дата);
		Запрос.УстановитьПараметр("Склад",		ДокументСсылка.Склад);
		Запрос.УстановитьПараметр("ФизЛицо",	ДокументСсылка.ФизЛицо);
		Запрос.УстановитьПараметр("ФизЛицоПолучатель",	ДокументСсылка.ФизЛицоПолучатель);
		Запрос.УстановитьПараметр("ВидОперации",ДокументСсылка.ВидОперации);
		Запрос.УстановитьПараметр("Организация",ДокументСсылка.Организация);
		Запрос.УстановитьПараметр("РеставрацияСоСклада",ДокументСсылка.РеставрацияСоСклада = 0);
		Если НЕ ЗначениеЗаполнено(ДокументСсылка.СтатьяЗатрат) Тогда
			Запрос.УстановитьПараметр("СтатьяЗатратМБП", ПолучитьСтатьюЗатратМБП(СтруктураДополнительныеСвойства));
		Иначе 
			Запрос.УстановитьПараметр("СтатьяЗатратМБП", ДокументСсылка.СтатьяЗатрат)
		КонецЕсли;
		
		Запрос.Выполнить();
		Если ДокументСсылка.ВидОперации = ПредопределенноеЗначение("Перечисление.ВидыОперацийДвижениеМБП.ВводМБПВЭксплуатацию") Тогда 
				
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВременнаяТаблицаТовары.Номенклатура,
		|	ВременнаяТаблицаТовары.НомерСтроки,
		|	ВременнаяТаблицаТовары.Партия,
		|	ВременнаяТаблицаТовары.ИндивидуальныйНомер,
		|	ВременнаяТаблицаТовары.ИндивидуальныйНомерКонец
		|ИЗ
		|	ВременнаяТаблицаТовары КАК ВременнаяТаблицаТовары
		|ГДЕ
		|	ВременнаяТаблицаТовары.ПоНомерам";
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		ТабЗначПоНом = Новый ТаблицаЗначений;
		
		МассивТипов = Новый Массив;
		МассивТипов.Добавить(Тип("СправочникСсылка.Номенклатура"));
		ДопустимыеТипы = Новый ОписаниеТипов(МассивТипов);
		ТабЗначПоНом.Колонки.Добавить("Номенклатура", ДопустимыеТипы);
		
		МассивТипов = Новый Массив;
		МассивТипов.Добавить(Тип("ДокументСсылка.ПоступлениеТоваровУслуг"));
		ДопустимыеТипы = Новый ОписаниеТипов(МассивТипов);
		ТабЗначПоНом.Колонки.Добавить("Партия", ДопустимыеТипы);
		
		МассивТипов = Новый Массив;
		МассивТипов.Добавить(Тип("Число"));
		ПараметрыЧисла = Новый КвалификаторыЧисла(6,0,ДопустимыйЗнак.Неотрицательный);
		ДопустимыеТипы = Новый ОписаниеТипов(МассивТипов,,ПараметрыЧисла);
		ТабЗначПоНом.Колонки.Добавить("СтрокаТЧ",ДопустимыеТипы);
		ТабЗначПоНом.Колонки.Добавить("НомерМБП",ДопустимыеТипы);

		
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			
			Для Старт = ВыборкаДетальныеЗаписи.ИндивидуальныйНомер По ВыборкаДетальныеЗаписи.ИндивидуальныйНомерКонец Цикл
				СтрокаИнв 				= ТабЗначПоНом.Добавить();
				СтрокаИнв.НомерМБП  	= Старт;
				СтрокаИнв.СтрокаТЧ  	= ВыборкаДетальныеЗаписи.НомерСтроки;
				СтрокаИнв.Партия    	= ВыборкаДетальныеЗаписи.Партия;
				СтрокаИнв.Номенклатура 	= ВыборкаДетальныеЗаписи.Номенклатура;				
			КонецЦикла;
		КонецЦикла;
		
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = СтруктураДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТабЗначНом.Номенклатура,
		|	ТабЗначНом.Партия,
		|	ТабЗначНом.НомерМБП,
		|	ТабЗначНом.СтрокаТЧ
		|ПОМЕСТИТЬ ВТНомераМБП
		|ИЗ
		|	&ТабЗначНом КАК ТабЗначНом";
		Запрос.УстановитьПараметр("ТабЗначНом", ТабЗначПоНом);
		Запрос.Выполнить();
		
	КонецЕсли;
	
	Ввод_СформироватьТаблицаМБПСклад(ДокументСсылка,СтруктураДополнительныеСвойства);
	Ввод_СформироватьТаблицаМБПЭксплуатация(ДокументСсылка,СтруктураДополнительныеСвойства);
	СформироватьТаблицаЗапасы(ДокументСсылка,СтруктураДополнительныеСвойства);
	СформироватьТаблицаХозрасчетный(ДокументСсылка,СтруктураДополнительныеСвойства);
	
КонецПроцедуры // ИнициализироватьДанныеДокумента()

#КонецОбласти

#Область ПроцедурыИФункцииОбщегоНазначения

Функция ПолучитьСтатьюЗатратМБП(СтруктураДополнительныеСвойства)

	СтруктураСчетаУчета = БухгалтерскийУчетВызовСервераПовтИсп.ПолучитьСчетаУчетаНоменклатуры(СтруктураДополнительныеСвойства.ДляПроведения.Организация, Справочники.Номенклатура.МБП);
	Возврат СтруктураСчетаУчета.СубконтоРасходов1;

КонецФункции // ПолучитьСтатьюЗатратМБП()

Процедура ЗаполнитьДатуВыдачи(Шапка, СтрокаТаблицы, ТаблицаДат)

	Отбор = Новый Структура;
	Отбор.Вставить("Ссылка", Шапка.Ссылка);
	Отбор.Вставить("МОЛ", 	Шапка.ФизЛицо);
	Отбор.Вставить("Номенклатура", 	СтрокаТаблицы.Номенклатура);
	Отбор.Вставить("ИнвентарныйНомер", 	СтрокаТаблицы.ИндивидуальныйНомер);

	МассивСтрок = ТаблицаДат.НайтиСтроки(Отбор);
	Если МассивСтрок.Количество()> 0 Тогда
		СтрокаТаблицы.ДатаВыдачи = МассивСтрок[0].ДатаВыдачи;	
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Возвращает заголовок документа для печатной формы.
//
// Параметры:
//  Шапка - любая структура с полями:
//           Номер         - Строка или Число - номер документа;
//           Дата          - Дата - дата документа;
//           Представление - Строка - (необязательный) платформенное представление ссылки на документ.
//                                    Если параметр НазваниеДокумента не задан, то название документа будет вычисляться
//                                    из этого параметра.
//  НазваниеДокумента - Строка - название документа (например, "Счет на оплату").
//
// Возвращаемое значение:
//  Строка - заголовок документа.
//
Функция СформироватьЗаголовокДокумента(Шапка, Знач НазваниеДокумента = "") Экспорт
	
	ДанныеДокумента = Новый Структура("Номер,Дата,Представление");
	ЗаполнитьЗначенияСвойств(ДанныеДокумента, Шапка);
	
	// Если название документа не передано, получим название по представлению документа.
	Если ПустаяСтрока(НазваниеДокумента) И ЗначениеЗаполнено(ДанныеДокумента.Представление) Тогда
		ПоложениеНомера = СтрНайти(ДанныеДокумента.Представление, ДанныеДокумента.Номер);
		Если ПоложениеНомера > 0 Тогда
			НазваниеДокумента = СокрЛП(Лев(ДанныеДокумента.Представление, ПоложениеНомера - 1));
		КонецЕсли;
	КонецЕсли;

	НомерНаПечать = ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(ДанныеДокумента.Номер);
	Возврат СтрШаблон(НСтр("ru = '%1 № %2 от %3'"),
		НазваниеДокумента, НомерНаПечать, Формат(ДанныеДокумента.Дата, "ДЛФ=DD"));
	
КонецФункции

#КонецОбласти

#Область ИнтерфейсПечати

// Функция формирует табличный документ с печатной формой Акт списания
//
// Возвращаемое значение:
//  Табличный документ - печатная форма
//
Функция ПечатьАктаСписания(МассивОбъектов, ОбъектыПечати)
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	МБПЭксплуатацияОстатки.Номенклатура,
		|	МБПЭксплуатацияОстатки.МОЛ,
		|	МБПЭксплуатацияОстатки.ДатаВыдачи,
		|	ДвижениеМБПТовары.Ссылка,
		|	МБПЭксплуатацияОстатки.ИнвНомер КАК ИнвентарныйНомер
		|ИЗ
		|	Документ.ДвижениеМБП.Товары КАК ДвижениеМБПТовары
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.МБПЭксплуатация.Остатки(, ) КАК МБПЭксплуатацияОстатки
		|		ПО ДвижениеМБПТовары.Номенклатура = МБПЭксплуатацияОстатки.Номенклатура
		|			И ДвижениеМБПТовары.Ссылка.ФизЛицо = МБПЭксплуатацияОстатки.МОЛ
		|			И ДвижениеМБПТовары.ИндивидуальныйНомер = МБПЭксплуатацияОстатки.ИнвНомер
		|ГДЕ
		|	ДвижениеМБПТовары.Ссылка В(&МассивОбъектов)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаДокумента.Ссылка,
		|	ТаблицаДокумента.Номер,
		|	ТаблицаДокумента.Дата,
		|	ТаблицаДокумента.Дата КАК ДатаДокумента,
		|	ТаблицаДокумента.Организация,
		|	ТаблицаДокумента.Комиссия.(
		|		Ссылка,
		|		ФизЛицо,
		|		Председатель,
		|		ВЫБОР
		|			КОГДА ТИПЗНАЧЕНИЯ(ТаблицаДокумента.Комиссия.ФизЛицо) = ТИП(Справочник.ФизическиеЛица)
		|				ТОГДА ВЫРАЗИТЬ(ТаблицаДокумента.Комиссия.ФизЛицо КАК Справочник.ФизическиеЛица).Наименование
		|			ИНАЧЕ ТаблицаДокумента.Комиссия.ФизЛицо
		|		КОНЕЦ КАК РасшифровкаПодписи,
		|		ВЫБОР
		|			КОГДА ТИПЗНАЧЕНИЯ(ТаблицаДокумента.Комиссия.Должность) = ТИП(Справочник.Должности)
		|				ТОГДА ВЫРАЗИТЬ(ТаблицаДокумента.Комиссия.Должность КАК Справочник.Должности).Наименование
		|			ИНАЧЕ ТаблицаДокумента.Комиссия.Должность
		|		КОНЕЦ КАК Должность
		|	),
		|	ТаблицаДокумента.Товары.(
		|		Ссылка,
		|		НомерСтроки,
		|		Номенклатура,
		|		Количество,
		|		Цена,
		|		Сумма,
		|		Номенклатура.ЕдиницаИзмерения КАК ЕдИзм,
		|		ИндивидуальныйНомер,
		|		ДАТАВРЕМЯ(1, 1, 1) КАК ДатаВыдачи,
		|    	Примечание
		|	),
		|	ТаблицаДокумента.ФизЛицо.Наименование,
		|	ТаблицаДокумента.ФизЛицо.Код КАК ТабельныйНомер,
		|	ТаблицаДокумента.Комментарий,
		|	ТаблицаДокумента.ФизЛицо
		|ИЗ
		|	Документ.ДвижениеМБП КАК ТаблицаДокумента
		|ГДЕ
		|	ТаблицаДокумента.Ссылка В(&МассивОбъектов)";
		
	Запрос = Новый Запрос(ТекстЗапроса);	
	Запрос.УстановитьПараметр("МассивОбъектов", МассивОбъектов);
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	ТаблицаДат = РезультатЗапроса[0].Выгрузить();	
	Шапка = РезультатЗапроса[1].Выбрать();
	
	ТабличныйДокумент = Новый ТабличныйДокумент;
	ТабличныйДокумент.КлючПараметровПечати = "ПараметрыПечати_АктСписания";
	
	Макет = УправлениеПечатью.МакетПечатнойФормы("Документ.ДвижениеМБП.ПФ_MXL_АктСписания");
	
	Пока Шапка.Следующий() Цикл
		Если ТабличныйДокумент.ВысотаТаблицы > 0 Тогда
			ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
		КонецЕсли;
		
		НомерСтрокиНачало = ТабличныйДокумент.ВысотаТаблицы + 1;
		
		// Подготовка данных
		ДанныеПечати = Новый Структура;
		
		ДанныеПечати.Вставить("ДатаДокумента", Шапка.ДатаДокумента);
		ДанныеПечати.Вставить("МОЛ", "МОЛ: " + Шапка.ФизЛицоНаименование + " (" + ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(Шапка.ТабельныйНомер) + ")");
		ДанныеПечати.Вставить("ТекстЗаголовка", СформироватьЗаголовокДокумента(Шапка, НСтр("ru = 'Акт списания'")));
		
		ТекстПодЗаголовка = НСтр("ru = 'Мы, нижеподписавшиеся,'");
		ВыборкаКомиссия = Шапка.Комиссия.Выбрать();
		Пока ВыборкаКомиссия.Следующий() Цикл
			ТекстПодЗаголовка = ТекстПодЗаголовка 
				+ ?(ЗначениеЗаполнено(ВыборкаКомиссия.Должность), ВыборкаКомиссия.Должность, "")
				+ " " + ВыборкаКомиссия.РасшифровкаПодписи + ", ";
		КонецЦикла;
		ТекстПодЗаголовка = ТекстПодЗаголовка + Символы.ПС + НСтр("ru = 'составили настоящий акт о том, что, '") + СокрЛП(Шапка.Комментарий);

		ДанныеПечати.Вставить("ТекстПодЗаголовка", ТекстПодЗаголовка);
		
		ВременнаяТаблицаТовары = Шапка.Товары.Выгрузить();
		ДанныеПечати.Вставить("Всего", ВременнаяТаблицаТовары.Итог("Сумма"));
		ДанныеПечати.Вставить("ИтоговаяСтрока", 
			СтрШаблон(НСтр("ru = 'Всего наименований %1, на сумму %2'"), 
			Формат(ВременнаяТаблицаТовары.Количество(), "ЧН=0; ЧГ=0"), 
			Формат(ДанныеПечати.Всего, "ЧЦ=15; ЧДЦ=2")));
		ДанныеПечати.Вставить("СуммаПрописью", БухгалтерскийУчетСервер.СформироватьСуммуПрописью(ДанныеПечати.Всего));
		
		// Инициализация массива областей макета
		МассивОбластейМакета = Новый Массив;
		МассивОбластейМакета.Добавить("Заголовок");
		МассивОбластейМакета.Добавить("ШапкаТаблицы");
		МассивОбластейМакета.Добавить("Строка");
		МассивОбластейМакета.Добавить("ИтогиТаблицы");
		МассивОбластейМакета.Добавить("СуммаПрописью");
		МассивОбластейМакета.Добавить("Подвал");
		МассивОбластейМакета.Добавить("ПодписиКомиссия");
		
		Для Каждого ИмяОбласти Из МассивОбластейМакета Цикл
			ОбластьМакета = Макет.ПолучитьОбласть(ИмяОбласти);
			
			Если ИмяОбласти <> "Строка"
				И ИмяОбласти <> "ПодписиКомиссия" Тогда
				ЗаполнитьЗначенияСвойств(ОбластьМакета.Параметры, ДанныеПечати);
				ТабличныйДокумент.Вывести(ОбластьМакета);
			ИначеЕсли ИмяОбласти = "Строка" Тогда 
				Для Каждого СтрокаТаблицы Из ВременнаяТаблицаТовары Цикл
					ЗаполнитьДатуВыдачи(Шапка, СтрокаТаблицы, ТаблицаДат);
					ОбластьМакета.Параметры.Заполнить(СтрокаТаблицы);
					ТабличныйДокумент.Вывести(ОбластьМакета);
				КонецЦикла;
			ИначеЕсли ИмяОбласти = "ПодписиКомиссия" Тогда
				// Формирование комиссии
				ВыборкаКомиссия = Шапка.Комиссия.Выбрать();
				Пока ВыборкаКомиссия.Следующий() Цикл
					ОбластьМакета.Параметры.Заполнить(ВыборкаКомиссия);
					ТабличныйДокумент.Вывести(ОбластьМакета);
				КонецЦикла;
			КонецЕсли;	
		КонецЦикла;
		
		УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабличныйДокумент, НомерСтрокиНачало, ОбъектыПечати, Шапка.Ссылка);
	КонецЦикла;
	
	ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;

	Возврат ТабличныйДокумент;
	
КонецФункции

//Формирует печатные формы.
//
// Параметры:
//  МассивОбъектов  - Массив    - ссылки на объекты, которые нужно распечатать;
//  ПараметрыПечати - Структура - дополнительные настройки печати;
//  КоллекцияПечатныхФорм - ТаблицаЗначений - сформированные табличные документы (выходной параметр)
//  ОбъектыПечати         - СписокЗначений  - значение - ссылка на объект;
//                                            представление - имя области в которой был выведен объект (выходной параметр);
//  ПараметрыВывода       - Структура       - дополнительные параметры сформированных табличных документов (выходной параметр).
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ПФ_MXL_АктСписания") Тогда
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, 
		"ПФ_MXL_АктСписания", 
		"Акт списания", 
		ПечатьАктаСписания(МассивОбъектов, ОбъектыПечати),
		,
		"Документ.ДвижениеМБП.ПФ_MXL_АктСписания");	
	КонецЕсли;

КонецПроцедуры

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "ПФ_MXL_АктСписания";
	КомандаПечати.Представление = НСтр("ru = 'Акт списания'");
	КомандаПечати.СписокФорм = "ФормаДокумента,ФормаСписка";
	КомандаПечати.ПроверкаПроведенияПередПечатью = Ложь;
	КомандаПечати.Порядок = 1;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли