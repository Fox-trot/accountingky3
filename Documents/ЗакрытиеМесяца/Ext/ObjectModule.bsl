#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Процедура - Выполнить закрытие месяца
//
Процедура ВыполнитьЗакрытиеМесяца() Экспорт
	НачатьТранзакцию();
	
	УПП = БухгалтерскийУчетВызовСервераПовтИсп.ПолучитьДанныеУчетнойПолитикиОрганизаций(Дата, Организация);
	
	// Расчет амортизации ОС
	Если РасчетАмортизацииОС Тогда 
		РассчитатьАмортизациюОсновныхСредств(УПП);
	КонецЕсли;	
		
	// Расчет переоценки валютных средств
	Если РасчетПереоценкиВалютныхСредств Тогда 
		РассчитатьПереоценкуВалютныхСредств();
	КонецЕсли;	
	
	Если РасчетНДС И УПП.УчетНДСНаАвансы Тогда 
		РассчитатьНДСНаАвансыДоотгрузку(УПП);
		РассчитатьНДС(УПП);
	КонецЕсли;
	
	// Расчет налога на имущество
	Если РасчетНалогаНаИмущество Тогда 
		РассчитатьНалогНаИмущество();
	КонецЕсли;	
	
	// Закрытие временных счетов учета
	Если ЗакрытьВременныеСчетаУчета Тогда 
		ВыполнитьЗакрытиеВременныхСчетовУчета();
	КонецЕсли;	
	
	// Закрытие парных счетов учета
	Если ЗакрытьПарныеСчетаУчета Тогда 
		ВыполнитьЗакрытиеПарныхСчетовУчета();
	КонецЕсли;	
	
	Попытка
		Записать(РежимЗаписиДокумента.Запись);
		ЗафиксироватьТранзакцию();
	Исключение
		ОтменитьТранзакцию();
		
		ТекстСообщения = НСтр("ru='Не удалось завершить запись документа.
			|Техническая информация об ошибке: %1'");
		ТекстСообщения = СтрШаблон(ТекстСообщения, КраткоеПредставлениеОшибки(ИнформацияОбОшибке()));	
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		
		ТекстСообщения = СтрШаблон(НСтр("ru = 'Не удалось завершить запись документа по причине: %1'"), ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		ЗаписьЖурналаРегистрации(НСтр("ru = 'Ошибка закрытия месяца'"), УровеньЖурналаРегистрации.Ошибка,,, ТекстСообщения);
	КонецПопытки;
	
	Если НЕ ПроверитьЗаполнение() Тогда 
		Возврат;
	КонецЕсли;		
	
	Попытка
		Записать(РежимЗаписиДокумента.Проведение);
	Исключение
		ТекстСообщения = НСтр("ru='Не удалось завершить проведение документа.
			|Техническая информация об ошибке: %1'");
		ТекстСообщения = СтрШаблон(ТекстСообщения, КраткоеПредставлениеОшибки(ИнформацияОбОшибке()));	
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		
		ТекстСообщения = СтрШаблон(НСтр("ru = 'Не удалось завершить проведение документа по причине: %1'"), ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		ЗаписьЖурналаРегистрации(НСтр("ru = 'Ошибка закрытия месяца'"), УровеньЖурналаРегистрации.Ошибка,,, ТекстСообщения);
	КонецПопытки;
КонецПроцедуры 

#КонецОбласти
	
#Область СлужебныеПроцедурыИФункции

// Процедура - Рассчитать амортизацию основных средств валютных средств
//
Процедура РассчитатьАмортизациюОсновныхСредств(УПП)

	// 1. Получение списка ОС принятых к учету
	// 2. Получение параметров ОС по настройке РасчетАмортизационныхОтчисленийПоМесяцам
	//		* РасчетАмортизационныхОтчисленийПоМесяцам = Истина - все ОС до 15-го числа расчетного месяца
	//		* РасчетАмортизационныхОтчисленийПоМесяцам = Ложь - расчет по дням от последнего изменения параметров, 
	//			в случае когда месяц расчета и месяц изменения параметров совпадают
	// 3. Расчет амортизации	
	
	ТекстЗапроса = 		
		////По просьбе НИ Накопленный износ
		"ВЫБРАТЬ
		|	СостоянияОССрезПоследних.Период КАК ДатаПринятияКУчету,
		|	СостоянияОССрезПоследних.ОсновноеСредство КАК ОсновноеСредство,
		|	СостоянияОССрезПоследних.Состояние
		|ПОМЕСТИТЬ ТаблицаСостоянияОССвод
		|ИЗ
		|	РегистрСведений.СостоянияОС.СрезПоследних(&КонецПериода, Организация = &Организация) КАК СостоянияОССрезПоследних
		|ГДЕ
		|	СостоянияОССрезПоследних.Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.ПринятоКУчету)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	СостоянияОССрезПоследних.Период,
		|	СостоянияОССрезПоследних.ОсновноеСредство,
		|	СостоянияОССрезПоследних.Состояние
		|ИЗ
		|	РегистрСведений.СостоянияОС.СрезПоследних(&КонецПериода, Организация = &Организация) КАК СостоянияОССрезПоследних
		|ГДЕ
		|	НЕ &РасчетАмортизационныхОтчисленийПоМесяцам
		|	И СостоянияОССрезПоследних.Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)
		|	И СостоянияОССрезПоследних.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ДатаПринятияКУчету,
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ТаблицаСостоянияОССвод.ОсновноеСредство КАК ОсновноеСредство,
		|	ТаблицаСостоянияОССвод.ДатаПринятияКУчету,
		|	ТаблицаСостоянияОССвод.Состояние
		|ПОМЕСТИТЬ ТаблицаСостоянияОС
		|ИЗ
		|	ТаблицаСостоянияОССвод КАК ТаблицаСостоянияОССвод
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СобытияОС.Период,
		|	СобытияОС.Организация,
		|	СобытияОС.ОсновноеСредство,
		|	СобытияОС.Событие
		|ПОМЕСТИТЬ ТаблицаСобытияОС
		|ИЗ
		|	РегистрСведений.СобытияОС КАК СобытияОС
		|ГДЕ
		|	СобытияОС.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И СобытияОС.ОсновноеСредство В
		|			(ВЫБРАТЬ
		|				ТаблицаСостоянияОС.ОсновноеСредство
		|			ИЗ
		|				ТаблицаСостоянияОС КАК ТаблицаСостоянияОС)
		|	И СобытияОС.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОбороты.Счет КАК Счет,
		|	ХозрасчетныйОбороты.Субконто1 КАК ОсновноеСредство,
		|	ВЫБОР
		|		КОГДА ХозрасчетныйОбороты.СуммаОборот < 0
		|			ТОГДА ХозрасчетныйОбороты.СуммаОборот * -1
		|		ИНАЧЕ ХозрасчетныйОбороты.СуммаОборот
		|	КОНЕЦ КАК СуммаИзмененияПараметров
		|ПОМЕСТИТЬ ТаблицаМодернизацияИзменениеПараметров
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Обороты(
		|			&НачалоПериода,
		|			&КонецПериода,
		|			Регистратор,
		|			Счет В (&СписокСчетовНакопленнойАмортизации),
		|			ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства),
		|			Организация = &Организация
		|				И Субконто1 В
		|					(ВЫБРАТЬ
		|						ТабСобытияОС.ОсновноеСредство
		|					ИЗ
		|						ТаблицаСобытияОС КАК ТабСобытияОС
		|					ГДЕ
		|						ТабСобытияОС.Событие.Наименование = ""Изменение параметров""),
		|			,
		|			) КАК ХозрасчетныйОбороты
		|ГДЕ
		|	ВЫРАЗИТЬ(ВЫРАЗИТЬ(ХозрасчетныйОбороты.Регистратор КАК Документ.МодернизацияОС).СобытиеОС КАК Справочник.СобытияОС).Наименование = ""Изменение параметров""
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет,
		|	ХозрасчетныйОстатки.Субконто1 КАК ОсновноеСредство,
		|	ВЫБОР
		|		КОГДА ХозрасчетныйОстатки.СуммаОстаток < 0
		|			ТОГДА ХозрасчетныйОстатки.СуммаОстаток * -1
		|		ИНАЧЕ ХозрасчетныйОстатки.СуммаОстаток
		|	КОНЕЦ КАК НакопленныйИзнос
		|ПОМЕСТИТЬ ТаблицаНакопленнаяАмортизация
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(&КонецПериода, Счет В (&СписокСчетовНакопленнойАмортизации), ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства), Организация = &Организация) КАК ХозрасчетныйОстатки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПараметрыУчетаОССрезПоследних.Период,
		|	ПараметрыУчетаОССрезПоследних.ОсновноеСредство КАК ОсновноеСредство,
		|	ПараметрыУчетаОССрезПоследних.ИнвентарныйНомер КАК ИнвентарныйНомер,
		|	ПараметрыУчетаОССрезПоследних.СчетУчета КАК СчетУчета,
		|	ПараметрыУчетаОССрезПоследних.ПервоначальнаяСтоимость КАК ПервоначальнаяСтоимость,
		|	ПараметрыУчетаОССрезПоследних.ЛиквидационнаяСтоимость КАК ЛиквидационнаяСтоимость,
		|	ПараметрыУчетаОССрезПоследних.СрокСлужбы КАК СрокСлужбы,
		|	ПараметрыУчетаОССрезПоследних.СпособНачисленияАмортизации КАК СпособНачисленияАмортизации,
		|	ПараметрыУчетаОССрезПоследних.СпособОтраженияРасходовПоАмортизации КАК СпособОтраженияРасходовПоАмортизации,
		|	ПараметрыУчетаОССрезПоследних.НормаАмортизации КАК НормаАмортизации,
		|	ПараметрыУчетаОССрезПоследних.ДатаВводаВЭксплуатацию КАК ДатаВводаВЭксплуатацию
		|ПОМЕСТИТЬ ТаблицаПараметрыУчетаОС
		|ИЗ
		|	РегистрСведений.ПараметрыУчетаОС.СрезПоследних(
		|			&НачалоПериода,
		|			Организация = &Организация
		|				И ОсновноеСредство В
		|					(ВЫБРАТЬ
		|						ТаблицаСостоянияОС.ОсновноеСредство
		|					ИЗ
		|						ТаблицаСостоянияОС КАК ТаблицаСостоянияОС)) КАК ПараметрыУчетаОССрезПоследних
		|ГДЕ
		|	&РасчетАмортизационныхОтчисленийПоМесяцам
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ПараметрыУчетаОССрезПервых.Период,
		|	ПараметрыУчетаОССрезПервых.ОсновноеСредство,
		|	ПараметрыУчетаОССрезПервых.ИнвентарныйНомер,
		|	ПараметрыУчетаОССрезПервых.СчетУчета,
		|	ПараметрыУчетаОССрезПервых.ПервоначальнаяСтоимость,
		|	ПараметрыУчетаОССрезПервых.ЛиквидационнаяСтоимость,
		|	ПараметрыУчетаОССрезПервых.СрокСлужбы,
		|	ПараметрыУчетаОССрезПервых.СпособНачисленияАмортизации,
		|	ПараметрыУчетаОССрезПервых.СпособОтраженияРасходовПоАмортизации,
		|	ПараметрыУчетаОССрезПервых.НормаАмортизации,
		|	ПараметрыУчетаОССрезПервых.ДатаВводаВЭксплуатацию
		|ИЗ
		|	РегистрСведений.ПараметрыУчетаОС.СрезПервых(
		|			&НачалоПериода,
		|			Организация = &Организация
		|				И ОсновноеСредство В
		|					(ВЫБРАТЬ
		|						ТаблицаСостоянияОС.ОсновноеСредство
		|					ИЗ
		|						ТаблицаСостоянияОС КАК ТаблицаСостоянияОС
		|					ГДЕ
		|						ТаблицаСостоянияОС.ДатаПринятияКУчету МЕЖДУ &НачалоПериода И КОНЕЦПЕРИОДА(ДОБАВИТЬКДАТЕ(&НачалоПериода, ДЕНЬ, 15), ДЕНЬ))) КАК ПараметрыУчетаОССрезПервых
		|ГДЕ
		|	&РасчетАмортизационныхОтчисленийПоМесяцам
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ПараметрыУчетаОССрезПоследних.Период,
		|	ПараметрыУчетаОССрезПоследних.ОсновноеСредство,
		|	ПараметрыУчетаОССрезПоследних.ИнвентарныйНомер,
		|	ПараметрыУчетаОССрезПоследних.СчетУчета,
		|	ПараметрыУчетаОССрезПоследних.ПервоначальнаяСтоимость,
		|	ПараметрыУчетаОССрезПоследних.ЛиквидационнаяСтоимость,
		|	ПараметрыУчетаОССрезПоследних.СрокСлужбы,
		|	ПараметрыУчетаОССрезПоследних.СпособНачисленияАмортизации,
		|	ПараметрыУчетаОССрезПоследних.СпособОтраженияРасходовПоАмортизации,
		|	ПараметрыУчетаОССрезПоследних.НормаАмортизации,
		|	ПараметрыУчетаОССрезПоследних.ДатаВводаВЭксплуатацию
		|ИЗ
		|	РегистрСведений.ПараметрыУчетаОС.СрезПоследних(
		|			&КонецПериода,
		|			Организация = &Организация
		|				И ОсновноеСредство В
		|					(ВЫБРАТЬ
		|						ТаблицаСостоянияОС.ОсновноеСредство
		|					ИЗ
		|						ТаблицаСостоянияОС КАК ТаблицаСостоянияОС)) КАК ПараметрыУчетаОССрезПоследних
		|ГДЕ
		|	НЕ &РасчетАмортизационныхОтчисленийПоМесяцам
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ТаблицаПараметрыУчетаОС.ОсновноеСредство КАК ОсновноеСредство,
		|	ТаблицаПараметрыУчетаОС.ИнвентарныйНомер,
		|	ТаблицаПараметрыУчетаОС.СчетУчета,
		|	ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость,
		|	ТаблицаПараметрыУчетаОС.ЛиквидационнаяСтоимость,
		|	ТаблицаПараметрыУчетаОС.СпособОтраженияРасходовПоАмортизации,
		|	ВЫБОР
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.ПоНормеАО)
		|				И &РасчетАмортизационныхОтчисленийПоМесяцам
		|			ТОГДА ТаблицаПараметрыУчетаОС.НормаАмортизации
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.ПоНормеАО)
		|				И НЕ &РасчетАмортизационныхОтчисленийПоМесяцам
		|			ТОГДА ВЫБОР
		|					КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|						ТОГДА (ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0) - ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость * 1 / 100) / ТаблицаПараметрыУчетаОС.СрокСлужбы / ДЕНЬ(КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)) * (ДЕНЬ(КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)) - (ДЕНЬ(ТаблицаПараметрыУчетаОС.Период) - 1))
		|					КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Изменение параметров""
		|						ТОГДА ТаблицаПараметрыУчетаОС.НормаАмортизации - ЕСТЬNULL(ТаблицаМодернизацияИзменениеПараметров.СуммаИзмененияПараметров, 0)
		|					ИНАЧЕ ТаблицаПараметрыУчетаОС.НормаАмортизации
		|				КОНЕЦ
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный)
		|				И ТаблицаПараметрыУчетаОС.СрокСлужбы = 0
		|			ТОГДА 0
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный)
		|				И НЕ &РасчетАмортизационныхОтчисленийПоМесяцам
		|				И &КонецПериода = КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)
		|			ТОГДА ВЫРАЗИТЬ((ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ТаблицаПараметрыУчетаОС.ЛиквидационнаяСтоимость - ВЫБОР
		|						КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|							ТОГДА ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0)
		|						ИНАЧЕ 0
		|					КОНЕЦ) / ТаблицаПараметрыУчетаОС.СрокСлужбы / ДЕНЬ(КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)) * (ДЕНЬ(КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)) - (ДЕНЬ(ТаблицаПараметрыУчетаОС.Период) - 1)) КАК ЧИСЛО(15, 2))
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный)
		|				И &КонецПериода = КОНЕЦПЕРИОДА(ТаблицаПараметрыУчетаОС.Период, МЕСЯЦ)
		|			ТОГДА ВЫБОР
		|					КОГДА &РасчетАмортизационныхОтчисленийПоМесяцам
		|						ТОГДА ВЫРАЗИТЬ((ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ВЫБОР
		|									КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|										ТОГДА ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0)
		|									ИНАЧЕ 0
		|								КОНЕЦ) / ТаблицаПараметрыУчетаОС.СрокСлужбы КАК ЧИСЛО(15, 2))
		|					ИНАЧЕ ВЫРАЗИТЬ((ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ТаблицаПараметрыУчетаОС.ЛиквидационнаяСтоимость - ВЫБОР
		|								КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|									ТОГДА ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0)
		|								ИНАЧЕ 0
		|							КОНЕЦ) / ТаблицаПараметрыУчетаОС.СрокСлужбы / ДЕНЬ(&КонецПериода) * (ДЕНЬ(&КонецПериода) - ДЕНЬ(ТаблицаПараметрыУчетаОС.Период) + 1) КАК ЧИСЛО(15, 2))
		|				КОНЕЦ
		|		КОГДА ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный)
		|			ТОГДА ВЫБОР
		|					КОГДА ТаблицаСостоянияОС.Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)
		|							И НЕ &РасчетАмортизационныхОтчисленийПоМесяцам
		|						ТОГДА (ВЫРАЗИТЬ((ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ТаблицаПараметрыУчетаОС.ЛиквидационнаяСтоимость - ВЫБОР
		|									КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|										ТОГДА ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0)
		|									ИНАЧЕ 0
		|								КОНЕЦ) / ТаблицаПараметрыУчетаОС.СрокСлужбы КАК ЧИСЛО(15, 2))) * ДЕНЬ(ТаблицаСостоянияОС.ДатаПринятияКУчету) / ДЕНЬ(КОНЕЦПЕРИОДА(ТаблицаСостоянияОС.ДатаПринятияКУчету, МЕСЯЦ))
		|					ИНАЧЕ ВЫРАЗИТЬ((ТаблицаПараметрыУчетаОС.ПервоначальнаяСтоимость - ТаблицаПараметрыУчетаОС.ЛиквидационнаяСтоимость - ВЫБОР
		|								КОГДА ТаблицаСобытияОС.Событие.Наименование = ""Модернизация""
		|									ТОГДА ЕСТЬNULL(ТаблицаНакопленнаяАмортизация.НакопленныйИзнос, 0)
		|								ИНАЧЕ 0
		|							КОНЕЦ) / ТаблицаПараметрыУчетаОС.СрокСлужбы КАК ЧИСЛО(15, 2))
		|				КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК АмортизацияЗаМесяц,
		|	ТаблицаПараметрыУчетаОС.СпособНачисленияАмортизации
		|ПОМЕСТИТЬ ТаблицаРасчетАмортизации
		|ИЗ
		|	ТаблицаПараметрыУчетаОС КАК ТаблицаПараметрыУчетаОС
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаСостоянияОС КАК ТаблицаСостоянияОС
		|		ПО ТаблицаПараметрыУчетаОС.ОсновноеСредство = ТаблицаСостоянияОС.ОсновноеСредство
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаСобытияОС КАК ТаблицаСобытияОС
		|		ПО ТаблицаПараметрыУчетаОС.ОсновноеСредство = ТаблицаСобытияОС.ОсновноеСредство
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНакопленнаяАмортизация КАК ТаблицаНакопленнаяАмортизация
		|		ПО ТаблицаПараметрыУчетаОС.ОсновноеСредство = ТаблицаНакопленнаяАмортизация.ОсновноеСредство
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаМодернизацияИзменениеПараметров КАК ТаблицаМодернизацияИзменениеПараметров
		|		ПО ТаблицаПараметрыУчетаОС.ОсновноеСредство = ТаблицаМодернизацияИзменениеПараметров.ОсновноеСредство
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаРасчетАмортизации.ОсновноеСредство КАК ОсновноеСредство,
		|	ТаблицаРасчетАмортизации.ИнвентарныйНомер,
		|	ТаблицаРасчетАмортизации.СчетУчета,
		|	ХозрасчетныйОстатки.Счет КАК СчетАмортизации,
		|	ТаблицаРасчетАмортизации.СпособНачисленияАмортизации,
		|	ТаблицаРасчетАмортизации.СпособОтраженияРасходовПоАмортизации,
		|	ТаблицаРасчетАмортизации.СпособОтраженияРасходовПоАмортизации.СчетЗатрат КАК СчетЗатрат,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0) >= ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость
		|			ТОГДА 0
		|		КОГДА ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость - ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0) < ТаблицаРасчетАмортизации.АмортизацияЗаМесяц
		|			ТОГДА ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость - ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0)
		|		ИНАЧЕ ТаблицаРасчетАмортизации.АмортизацияЗаМесяц
		|	КОНЕЦ КАК Сумма
		|ИЗ
		|	ТаблицаРасчетАмортизации КАК ТаблицаРасчетАмортизации
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Хозрасчетный.Остатки(
		|				&КонецПериода,
		|				,
		|				ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства),
		|				Организация = &Организация
		|					И Субконто1 В
		|						(ВЫБРАТЬ
		|							ТаблицаСостоянияОС.ОсновноеСредство
		|						ИЗ
		|							ТаблицаСостоянияОС КАК ТаблицаСостоянияОС)) КАК ХозрасчетныйОстатки
		|		ПО ТаблицаРасчетАмортизации.ОсновноеСредство = ХозрасчетныйОстатки.Субконто1
		|ГДЕ
		|	НЕ ВЫБОР
		|				КОГДА ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0) >= ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость
		|					ТОГДА 0
		|				КОГДА ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость - ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0) < ТаблицаРасчетАмортизации.АмортизацияЗаМесяц
		|					ТОГДА ТаблицаРасчетАмортизации.ПервоначальнаяСтоимость - ТаблицаРасчетАмортизации.ЛиквидационнаяСтоимость - ЕСТЬNULL(ХозрасчетныйОстатки.СуммаОстатокКт, 0)
		|				ИНАЧЕ ТаблицаРасчетАмортизации.АмортизацияЗаМесяц
		|			КОНЕЦ = 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	ТаблицаРасчетАмортизации.ОсновноеСредство.Наименование
		|АВТОУПОРЯДОЧИВАНИЕ";

			
	Запрос = Новый Запрос(ТекстЗапроса);
	СписокСчетовНаопленногоИзноса = Новый СписокЗначений;
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.АмортизацияЗданияСооружения);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияОборудование);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияКонторскоеОборудование);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияМебельИПринадлежности);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияТранспортныеСредства);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияБлагоустройствоАрендованнойСобственности);
	СписокСчетовНаопленногоИзноса.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияБлагоустройствоЗемльныхУчастков);

	Запрос.УстановитьПараметр("СписокСчетовНакопленнойАмортизации",СписокСчетовНаопленногоИзноса);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(Дата));
	Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(Дата));
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("РасчетАмортизационныхОтчисленийПоМесяцам", УПП.РасчетАмортизационныхОтчисленийПоМесяцам); 
	
	АмортизацияОС.Загрузить(Запрос.Выполнить().Выгрузить())
КонецПроцедуры // РассчитатьАмортизациюОсновныхСредств()

// Процедура - Рассчитать переоценку валютных средств
//
Процедура РассчитатьПереоценкуВалютныхСредств()
	
	// Получение суммы остатков по счетам учета по условию
	//	* Валютный
	//	* Без СпособыПризнанияКурсовойРазницы Оперативно или НеРассчитывать	
	ТекстЗапроса = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Хозрасчетный.Ссылка КАК СчетУчета
		|ПОМЕСТИТЬ ТаблицаСчетаУчета
		|ИЗ
		|	ПланСчетов.Хозрасчетный КАК Хозрасчетный
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаСОсобымПорядкомПереоценки КАК СчетаУчетаСОсобымПорядкомПереоценки
		|		ПО Хозрасчетный.Ссылка = СчетаУчетаСОсобымПорядкомПереоценки.СчетУчета
		|ГДЕ
		|	НЕ Хозрасчетный.Забалансовый
		|	И НЕ Хозрасчетный.ЗапретитьИспользоватьВПроводках
		|	И Хозрасчетный.Валютный
		|	И НЕ(ЕСТЬNULL(СчетаУчетаСОсобымПорядкомПереоценки.СпособПризнанияКурсовойРазницы, ЗНАЧЕНИЕ(Перечисление.СпособыПризнанияКурсовойРазницы.ПустаяСсылка)) = ЗНАЧЕНИЕ(Перечисление.СпособыПризнанияКурсовойРазницы.Оперативно)
		|				ИЛИ ЕСТЬNULL(СчетаУчетаСОсобымПорядкомПереоценки.СпособПризнанияКурсовойРазницы, ЗНАЧЕНИЕ(Перечисление.СпособыПризнанияКурсовойРазницы.ПустаяСсылка)) = ЗНАЧЕНИЕ(Перечисление.СпособыПризнанияКурсовойРазницы.НеРассчитывать))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет КАК СчетУчета,
		|	ХозрасчетныйОстатки.Субконто1,
		|	ХозрасчетныйОстатки.Субконто2,
		|	ХозрасчетныйОстатки.Субконто3,
		|	ХозрасчетныйОстатки.Валюта,
		|	ВЫБОР
		|		КОГДА ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0) < 0
		|			ТОГДА (ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0)) * -1
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СуммаДоход,
		|	ВЫБОР
		|		КОГДА ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0) > 0
		|			ТОГДА ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СуммаУбыток
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(
		|			&МоментВремени,
		|			Счет В
		|				(ВЫБРАТЬ
		|					ТаблицаСчетаУчета.СчетУчета
		|				ИЗ
		|					ТаблицаСчетаУчета КАК ТаблицаСчетаУчета),
		|			,
		|			Организация = &Организация) КАК ХозрасчетныйОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(&Период, ) КАК КурсыВалютСрезПоследних
		|		ПО ХозрасчетныйОстатки.Валюта = КурсыВалютСрезПоследних.Валюта
		|ГДЕ
		|	ХозрасчетныйОстатки.СуммаОстаток <> ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0)
		|	И (ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0) >= 0.005
		|			ИЛИ ХозрасчетныйОстатки.СуммаОстаток - ХозрасчетныйОстатки.ВалютнаяСуммаОстаток * ЕСТЬNULL(КурсыВалютСрезПоследних.Курс, 0) * ЕСТЬNULL(КурсыВалютСрезПоследних.Кратность, 0) <= -0.005)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ХозрасчетныйОстатки.Счет.Код";
	Запрос = Новый Запрос(ТекстЗапроса);
	Запрос.УстановитьПараметр("МоментВремени", Дата + 1); 
	Запрос.УстановитьПараметр("Период", Дата); 
	Запрос.УстановитьПараметр("Организация", Организация);
	
	ПереоценкаВалюты.Загрузить(Запрос.Выполнить().Выгрузить())
	
КонецПроцедуры // РассчитатьПереоценкуВалютныхСредств()

// Процедура - Рассчитать НДС на авансы и доотгрузку
//
Процедура РассчитатьНДСНаАвансыДоотгрузку(УПП)
	АвансыДоотгрузкаРасшифровка.Очистить();
	
	СтавкаНСППоУмолчанию = УПП.СтавкаНСППоУмолчанию;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СчетаРасчетовСКонтрагентами.СчетРасчетовПокупателя КАК СчетУчета
	|ПОМЕСТИТЬ ВременнаяТаблицаСчетаРасчетовСКонтрагентами
	|ИЗ
	|	РегистрСведений.СчетаРасчетовСКонтрагентами КАК СчетаРасчетовСКонтрагентами
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СчетаРасчетовСКонтрагентами.СчетАвансовПокупателя
	|ИЗ
	|	РегистрСведений.СчетаРасчетовСКонтрагентами КАК СчетаРасчетовСКонтрагентами
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаСчетаРасчетовСКонтрагентами.СчетУчета
	|ПОМЕСТИТЬ ВременнаяТаблицаСчетаРасчетовАвансов
	|ИЗ
	|	ВременнаяТаблицаСчетаРасчетовСКонтрагентами КАК ВременнаяТаблицаСчетаРасчетовСКонтрагентами
	|ГДЕ
	|	ВременнаяТаблицаСчетаРасчетовСКонтрагентами.СчетУчета <> ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ХозрасчетныйОстаткиИОбороты.Регистратор КАК Регистратор,
	|	ХозрасчетныйОстаткиИОбороты.Субконто1 КАК Контрагент,
	|	ХозрасчетныйОстаткиИОбороты.Субконто2 КАК Договор,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.РеализацияТоваровУслуг) ССЫЛКА Документ.РеализацияТоваровУслуг
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.РеализацияТоваровУслуг).Дата
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ВозвратТоваровОтПокупателя) ССЫЛКА Документ.ВозвратТоваровОтПокупателя
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ВозвратТоваровОтПокупателя).Дата
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеВходящее) ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеВходящее).Дата
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеИсходящее) ССЫЛКА Документ.ПлатежноеПоручениеИсходящее
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеИсходящее).Дата
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПриходныйКассовыйОрдер) ССЫЛКА Документ.ПриходныйКассовыйОрдер
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПриходныйКассовыйОрдер).Дата
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.РасходныйКассовыйОрдер) ССЫЛКА Документ.РасходныйКассовыйОрдер
	|			ТОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.РасходныйКассовыйОрдер).Дата
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК ДатаДокумента,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеВходящее) ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	|				ИЛИ ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПлатежноеПоручениеИсходящее) ССЫЛКА Документ.ПлатежноеПоручениеИсходящее
	|				ИЛИ ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.ПриходныйКассовыйОрдер) ССЫЛКА Документ.ПриходныйКассовыйОрдер
	|				ИЛИ ВЫРАЗИТЬ(ХозрасчетныйОстаткиИОбороты.Регистратор КАК Документ.РасходныйКассовыйОрдер) ССЫЛКА Документ.РасходныйКассовыйОрдер
	|			ТОГДА -ХозрасчетныйОстаткиИОбороты.СуммаОборот
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК Оплата
	|ПОМЕСТИТЬ ВременнаяТаблицаОплатаТекущегоМесяца
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.ОстаткиИОбороты(
	|			&ДатаН,
	|			&ДатаК,
	|			Авто,
	|			Движения,
	|			Счет В
	|				(ВЫБРАТЬ
	|					ВременнаяТаблицаСчетаРасчетовАвансов.СчетУчета
	|				ИЗ
	|					ВременнаяТаблицаСчетаРасчетовАвансов КАК ВременнаяТаблицаСчетаРасчетовАвансов),
	|			&ВидыСубконто,
	|			Организация = &Организация) КАК ХозрасчетныйОстаткиИОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РеализацияОбороты.ДокументРеализации КАК Регистратор,
	|	РеализацияОбороты.ПериодСекунда КАК ДатаДокумента,
	|	РеализацияОбороты.Контрагент,
	|	РеализацияОбороты.Договор,
	|	РеализацияОбороты.ДоходОборот + РеализацияОбороты.СуммаНДСОборот + РеализацияОбороты.СуммаНСПОборот КАК Отгрузка
	|ПОМЕСТИТЬ ВременнаяТаблицаОтгрузкаТекущегоМесяца
	|ИЗ
	|	РегистрНакопления.Реализация.Обороты(&ДатаН, &ДатаК, Авто, Организация = &Организация) КАК РеализацияОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ХозрасчетныйОстатки.Субконто1 КАК Контрагент,
	|	ХозрасчетныйОстатки.Субконто2 КАК Договор,
	|	ХозрасчетныйОстатки.СуммаОстаток КАК ОстатокОтгрузки
	|ПОМЕСТИТЬ ВременнаяТаблицаОстаткиОтгрузкиНаНачало
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.Остатки(
	|			&ДатаН,
	|			Счет В
	|				(ВЫБРАТЬ
	|					ВременнаяТаблицаСчетаРасчетовАвансов.СчетУчета
	|				ИЗ
	|					ВременнаяТаблицаСчетаРасчетовАвансов КАК ВременнаяТаблицаСчетаРасчетовАвансов),
	|			&ВидыСубконто,
	|			Организация = &Организация) КАК ХозрасчетныйОстатки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Контрагент КАК Контрагент,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор КАК Договор,
	|	ВЫРАЗИТЬ(ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор КАК Справочник.ДоговорыКонтрагентов).СтавкаНДС КАК СтавкаНДС
	|ПОМЕСТИТЬ ВременнаяТаблицаСписокКонтрагентов
	|ИЗ
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца КАК ВременнаяТаблицаОтгрузкаТекущегоМесяца
	|
	|СГРУППИРОВАТЬ ПО
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Контрагент,
	|	ВЫРАЗИТЬ(ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор КАК Справочник.ДоговорыКонтрагентов).СтавкаНДС
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АвансыДоотгрузкаОстатки.Контрагент КАК Контрагент,
	|	АвансыДоотгрузкаОстатки.Договор КАК Договор,
	|	АвансыДоотгрузкаОстатки.ДокументА КАК ДокументА,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПлатежноеПоручениеВходящее) ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	|			ТОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПлатежноеПоручениеВходящее).Дата
	|		КОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПлатежноеПоручениеИсходящее) ССЫЛКА Документ.ПлатежноеПоручениеИсходящее
	|			ТОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПлатежноеПоручениеИсходящее).Дата
	|		КОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПриходныйКассовыйОрдер) ССЫЛКА Документ.ПриходныйКассовыйОрдер
	|			ТОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.ПриходныйКассовыйОрдер).Дата
	|		КОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.РасходныйКассовыйОрдер) ССЫЛКА Документ.РасходныйКассовыйОрдер
	|			ТОГДА ВЫРАЗИТЬ(АвансыДоотгрузкаОстатки.ДокументА КАК Документ.РасходныйКассовыйОрдер).Дата
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК ДатаДокумента,
	|	АвансыДоотгрузкаОстатки.СуммаОстаток КАК СуммаОстаток,
	|	АвансыДоотгрузкаОстатки.СуммаНДСОстаток КАК СуммаНДСОстаток,
	|	АвансыДоотгрузкаОстатки.СуммаНСПОстаток КАК СуммаНСПОстаток
	|ПОМЕСТИТЬ ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца
	|ИЗ
	|	РегистрНакопления.АвансыДоотгрузка.Остатки(
	|			&ДатаН,
	|			Организация = &Организация
	|				И (Контрагент, Договор) В
	|					(ВЫБРАТЬ
	|						ВременнаяТаблицаСписокКонтрагентов.Контрагент,
	|						ВременнаяТаблицаСписокКонтрагентов.Договор
	|					ИЗ
	|						ВременнаяТаблицаСписокКонтрагентов КАК ВременнаяТаблицаСписокКонтрагентов)) КАК АвансыДоотгрузкаОстатки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.ДокументА КАК Документ,
	|	ВременнаяТаблицаСписокКонтрагентов.Контрагент КАК Контрагент,
	|	ЕСТЬNULL(ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.СуммаОстаток, 0) КАК АвансыОплата,
	|	ЕСТЬNULL(ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.СуммаНДСОстаток, 0) КАК СуммаНДСОстаток,
	|	ЕСТЬNULL(ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.СуммаНСПОстаток, 0) КАК СуммаНСПОстаток,
	|	ВременнаяТаблицаСписокКонтрагентов.Договор КАК Договор,
	|	ЕСТЬNULL(СтавкиНДССрезПоследних.Ставка, 0) КАК ЗначениеСтавкиНДС,
	|	ЕСТЬNULL(СтавкиНСПСрезПоследних.СтавкаПлательщикНДС, 0) КАК ЗначениеСтавкиНСП,
	|	ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.ДатаДокумента,
	|	ЕСТЬNULL(ВременнаяТаблицаОстаткиОтгрузкиНаНачало.ОстатокОтгрузки, 0) КАК ОстатокОтгрузки
	|ПОМЕСТИТЬ ВременнаяТаблицаДвиженияИОстатки
	|ИЗ
	|	ВременнаяТаблицаСписокКонтрагентов КАК ВременнаяТаблицаСписокКонтрагентов
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца КАК ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца
	|		ПО ВременнаяТаблицаСписокКонтрагентов.Контрагент = ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.Контрагент
	|			И ВременнаяТаблицаСписокКонтрагентов.Договор = ВременнаяТаблицаОстаткиАвансовНаНачалоМесяца.Договор
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиНДС.СрезПоследних(&ДатаН, ) КАК СтавкиНДССрезПоследних
	|		ПО ВременнаяТаблицаСписокКонтрагентов.СтавкаНДС = СтавкиНДССрезПоследних.СтавкаНДС
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВременнаяТаблицаОстаткиОтгрузкиНаНачало КАК ВременнаяТаблицаОстаткиОтгрузкиНаНачало
	|		ПО ВременнаяТаблицаСписокКонтрагентов.Контрагент = ВременнаяТаблицаОстаткиОтгрузкиНаНачало.Контрагент
	|			И ВременнаяТаблицаСписокКонтрагентов.Договор = ВременнаяТаблицаОстаткиОтгрузкиНаНачало.Договор,
	|	РегистрСведений.СтавкиНСП.СрезПоследних(&ДатаН, СтавкаНСП = &СтавкаНСП) КАК СтавкиНСПСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаДвиженияИОстатки.Документ КАК ДокументАванса,
	|	ВременнаяТаблицаДвиженияИОстатки.Контрагент КАК Контрагент,
	|	ВременнаяТаблицаДвиженияИОстатки.Договор КАК Договор,
	|	ВременнаяТаблицаДвиженияИОстатки.АвансыОплата КАК АвансыОплата,
	|	ВременнаяТаблицаДвиженияИОстатки.СуммаНДСОстаток КАК СуммаНДСОстаток,
	|	ВременнаяТаблицаДвиженияИОстатки.СуммаНСПОстаток КАК СуммаНСПОстаток,
	|	ВременнаяТаблицаДвиженияИОстатки.ЗначениеСтавкиНДС КАК ЗначениеСтавкиНДС,
	|	ВременнаяТаблицаДвиженияИОстатки.ЗначениеСтавкиНСП КАК ЗначениеСтавкиНСП,
	|	ВременнаяТаблицаДвиженияИОстатки.ОстатокОтгрузки КАК ОстатокОтгрузки
	|ИЗ
	|	ВременнаяТаблицаДвиженияИОстатки КАК ВременнаяТаблицаДвиженияИОстатки
	|
	|УПОРЯДОЧИТЬ ПО
	|	Договор,
	|	ВременнаяТаблицаДвиженияИОстатки.ДатаДокумента
	|ИТОГИ
	|	МАКСИМУМ(ДокументАванса),
	|	МАКСИМУМ(Контрагент),
	|	СУММА(АвансыОплата),
	|	МАКСИМУМ(СуммаНДСОстаток),
	|	МАКСИМУМ(СуммаНСПОстаток),
	|	МАКСИМУМ(ЗначениеСтавкиНДС),
	|	МАКСИМУМ(ЗначениеСтавкиНСП),
	|	МАКСИМУМ(ОстатокОтгрузки)
	|ПО
	|	Договор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Регистратор КАК Регистратор,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Контрагент КАК Контрагент,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Договор КАК Договор,
	|	СУММА(ВременнаяТаблицаОплатаТекущегоМесяца.Оплата) КАК Оплата,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.ДатаДокумента КАК ДатаДокумента
	|ИЗ
	|	ВременнаяТаблицаОплатаТекущегоМесяца КАК ВременнаяТаблицаОплатаТекущегоМесяца
	|ГДЕ
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Оплата <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Контрагент,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Договор,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.Регистратор,
	|	ВременнаяТаблицаОплатаТекущегоМесяца.ДатаДокумента
	|
	|УПОРЯДОЧИТЬ ПО
	|	Договор,
	|	ДатаДокумента УБЫВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Регистратор,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Контрагент,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор КАК Договор,
	|	СУММА(ВременнаяТаблицаОтгрузкаТекущегоМесяца.Отгрузка) КАК Отгрузка,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.ДатаДокумента КАК ДатаДокумента
	|ИЗ
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца КАК ВременнаяТаблицаОтгрузкаТекущегоМесяца
	|ГДЕ
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Отгрузка <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Контрагент,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Договор,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.Регистратор,
	|	ВременнаяТаблицаОтгрузкаТекущегоМесяца.ДатаДокумента
	|
	|УПОРЯДОЧИТЬ ПО
	|	Договор,
	|	ДатаДокумента";
		
	ВидыСубконто = Новый Массив;
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Контрагенты);	
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Договоры);
	
	Запрос.УстановитьПараметр("ДатаК", 		 	КонецМесяца(Дата));
	Запрос.УстановитьПараметр("ДатаН", 		 	НачалоМесяца(Дата));
	Запрос.УстановитьПараметр("ВидыСубконто",	ВидыСубконто);
	Запрос.УстановитьПараметр("Организация", 	Организация);
	Запрос.УстановитьПараметр("СтавкаНСП", 		СтавкаНСППоУмолчанию);
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ВыборкаДоговор 	= РезультатЗапроса[8].Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	ТаблицаОплат 	= РезультатЗапроса[9].Выгрузить();
	ТаблицаОтгрузок = РезультатЗапроса[10].Выгрузить();
		
	Пока ВыборкаДоговор.Следующий() Цикл
		Договор 				= ВыборкаДоговор.Договор;
		Контрагент 				= ВыборкаДоговор.Контрагент; 
		АвансыОплатаИтог 		= ВыборкаДоговор.АвансыОплата;
		ОстатокОтгрузки 		= ?(ВыборкаДоговор.ОстатокОтгрузки > 0, ВыборкаДоговор.ОстатокОтгрузки, 0);
		ТекущаяОтгрузкаОстатокИтог	= 0;
		ТекущаяОплатаОстатокИтог	= 0;
		
		ВыборкаДокумента = ВыборкаДоговор.Выбрать();
		
		// Начало << Доотгрузка
		
		Отбор = Новый Структура;
		Отбор.Вставить("Договор", ВыборкаДоговор.Договор);		
		ТаблицаОплатКонтрагента 	= ТаблицаОплат.Скопировать(Отбор, "Регистратор, Оплата");
		ТаблицаОтгрузокКонтрагента 	= ТаблицаОтгрузок.Скопировать(Отбор, "Регистратор, Отгрузка");
		
		Пока ВыборкаДокумента.Следующий() 
			И АвансыОплатаИтог > 0 
			И ТаблицаОтгрузокКонтрагента.Количество() > 0 
			И ТаблицаОтгрузокКонтрагента.Итог("Отгрузка") > 0 Цикл
				
			ТекущаяОплата = ВыборкаДокумента.АвансыОплата;
			ТекущийОстатокНДС = ВыборкаДокумента.СуммаНДСОстаток;
			ТекущийОстатокНСП = ВыборкаДокумента.СуммаНСПОстаток;
			ПродолжитьОбходТаблицы = Истина;
			Пока ПродолжитьОбходТаблицы Цикл
				Для каждого СтрокаТаблицы Из ТаблицаОтгрузокКонтрагента Цикл
					Если ТекущаяОплата > 0 Тогда
						СтрокаРасшифровка = АвансыДоотгрузкаРасшифровка.Добавить();	
						ЗаполнитьЗначенияСвойств(СтрокаРасшифровка, ВыборкаДокумента);
						СтрокаРасшифровка.ДокументОплаты = СтрокаТаблицы.Регистратор;
						СтрокаРасшифровка.Аванс = Перечисления.ВидыАвансовОтгрузки.Доотгрузка;
						Если ТекущаяОплата > СтрокаТаблицы.Отгрузка Тогда
							СтрокаРасшифровка.Сумма = СтрокаТаблицы.Отгрузка;	
							ТекущаяОплата = ТекущаяОплата - СтрокаТаблицы.Отгрузка;
							СтрокаРасшифровка.НДС 	= СтрокаТаблицы.Отгрузка * Окр(ВыборкаДокумента.СуммаНДСОстаток / ВыборкаДокумента.АвансыОплата, 2);
							СтрокаРасшифровка.НСП 	= СтрокаТаблицы.Отгрузка * Окр(ВыборкаДокумента.СуммаНСПОстаток / ВыборкаДокумента.АвансыОплата, 2);
							ТекущийОстатокНДС 		= ТекущийОстатокНДС - СтрокаРасшифровка.НДС;
							ТекущийОстатокНСП 		= ТекущийОстатокНСП - СтрокаРасшифровка.НСП;
							ТаблицаОтгрузокКонтрагента.Удалить(СтрокаТаблицы);
						Иначе
							СтрокаРасшифровка.Сумма = ТекущаяОплата;
							СтрокаРасшифровка.НДС 	= ТекущийОстатокНДС;
							СтрокаРасшифровка.НСП 	= ТекущийОстатокНСП;						
							СтрокаТаблицы.Отгрузка = СтрокаТаблицы.Отгрузка - ТекущаяОплата;
							ТекущаяОплата = 0;
							ПродолжитьОбходТаблицы = Ложь;
							Прервать;
						КонецЕсли;					
					Иначе
						ПродолжитьОбходТаблицы = Ложь;
						Прервать;
					КонецЕсли;
				КонецЦикла;		
				Если ТаблицаОтгрузокКонтрагента.Количество() = 0 Тогда
					ПродолжитьОбходТаблицы = Ложь;				
				КонецЕсли;								
			
			КонецЦикла;
		
		КонецЦикла;
		// Доотгрузка >> Конец
	 				
		// Заполненик авансов в ТЧ АвансыДоотгрузкаРасшифровка
		ТекущаяОтгрузкаОстатокИтог = ТаблицаОтгрузокКонтрагента.Итог("Отгрузка");
		ТекущаяОплатаОстатокИтог   = ТаблицаОплатКонтрагента.Итог("Оплата");
		СальдоОборотовТекущегоМесяца = ТекущаяОплатаОстатокИтог - ТекущаяОтгрузкаОстатокИтог; 
		ВременнаяТаблицаЗначений = АвансыДоотгрузкаРасшифровка.ВыгрузитьКолонки();
		ВременнаяТаблицаЗначений.Колонки.Добавить("ДатаДокумента", ОбщегоНазначения.ОписаниеТипаДата(ЧастиДаты.ДатаВремя));
		СуммаПревышенияОплаты = СальдоОборотовТекущегоМесяца - ОстатокОтгрузки;
		Если ОстатокОтгрузки > СальдоОборотовТекущегоМесяца Тогда
			ОстатокОтгрузки = ОстатокОтгрузки - СальдоОборотовТекущегоМесяца;
		Иначе	
		    ОстатокОтгрузки = 0;
		КонецЕсли;		
		Если СуммаПревышенияОплаты > 0 Тогда
			ТаблицаОплатКонтрагента 	= ТаблицаОплат.Скопировать(Отбор, "Регистратор, ДатаДокумента, Оплата");
			Для каждого СтрокаТаблицы Из ТаблицаОплатКонтрагента Цикл
				СтрокаРасшифровка = ВременнаяТаблицаЗначений.Добавить();	
				ЗаполнитьЗначенияСвойств(СтрокаРасшифровка, ВыборкаДоговор);
				ЗаполнитьЗначенияСвойств(СтрокаРасшифровка, СтрокаТаблицы);
				СтрокаРасшифровка.ДокументАванса = СтрокаТаблицы.Регистратор;
				СтрокаРасшифровка.Аванс = Перечисления.ВидыАвансовОтгрузки.Аванс;
				Если СуммаПревышенияОплаты > СтрокаТаблицы.Оплата Тогда
					СтрокаРасшифровка.Сумма = СтрокаТаблицы.Оплата;
					СтрокаРасшифровка.НДС 	= СтрокаТаблицы.Оплата * Окр(ВыборкаДоговор.ЗначениеСтавкиНДС / 100, 2);
					СтрокаРасшифровка.НСП 	= СтрокаТаблицы.Оплата * Окр(ВыборкаДоговор.ЗначениеСтавкиНСП / 100, 2);					
					СуммаПревышенияОплаты 	= СуммаПревышенияОплаты - СтрокаТаблицы.Оплата;
				Иначе
					СтрокаРасшифровка.Сумма = СуммаПревышенияОплаты;
					СтрокаРасшифровка.НДС 	= СуммаПревышенияОплаты * Окр(ВыборкаДоговор.ЗначениеСтавкиНДС / 100, 2);
					СтрокаРасшифровка.НСП 	= СуммаПревышенияОплаты * Окр(ВыборкаДоговор.ЗначениеСтавкиНСП / 100, 2);						
					СуммаПревышенияОплаты 	= 0;
				КонецЕсли;		
				Если СуммаПревышенияОплаты <= 0 Тогда
					Прервать;
				КонецЕсли;			
			КонецЦикла;			
			
		КонецЕсли;
		
		// Сортируем ТЧ АвансыДоотгрузкаРасшифровка по ФИФО
	    ВременнаяТаблицаЗначений.Сортировать("ДатаДокумента");
		Для каждого СтрокаТаблицы Из ВременнаяТаблицаЗначений Цикл
			СтрокаРасшифровка = АвансыДоотгрузкаРасшифровка.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРасшифровка, СтрокаТаблицы);		
		КонецЦикла;
		
		ВременнаяТаблицаЗначений = АвансыДоотгрузкаРасшифровка.Выгрузить();
		ВременнаяТаблицаЗначений.Свернуть("Аванс, Контрагент, Договор", "Сумма, НДС, НСП");
	    АвансыДоотгрузка.Загрузить(ВременнаяТаблицаЗначений);
		
	КонецЦикла;	
	
КонецПроцедуры

// Процедура - Рассчитать НДС для Отчета по НДС
Процедура РассчитатьНДС(УПП)
	НачалоПериода 	= НачалоМесяца(Дата);
	КонецПериода 	= КонецМесяца(Дата);
	
	НДС.Очистить();
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("НачалоМесяца", 	НачалоПериода);
	Запрос.УстановитьПараметр("КонецМесяца", 	КонецПериода);
	Запрос.УстановитьПараметр("Организация", 	Организация);
	
	МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СУММА(ЗакрытиеМесяцаАвансыДоотгрузка.Сумма) КАК СуммаДоотгрузки,
	|	СУММА(ЗакрытиеМесяцаАвансыДоотгрузка.НДС) КАК СуммаНДСДоотгрузки
	|ПОМЕСТИТЬ ВременнаяТаблицаДоотгрузка
	|ИЗ
	|	Документ.ЗакрытиеМесяца.АвансыДоотгрузка КАК ЗакрытиеМесяцаАвансыДоотгрузка
	|ГДЕ
	|	ЗакрытиеМесяцаАвансыДоотгрузка.Ссылка = &Ссылка
	|	И ЗакрытиеМесяцаАвансыДоотгрузка.Аванс = ЗНАЧЕНИЕ(Перечисление.ВидыАвансовОтгрузки.Доотгрузка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(РеализацияОбороты.ДоходОборот) КАК СуммаПродажОбщая
	|ПОМЕСТИТЬ ВременнаяВсяРеализация
	|ИЗ
	|	РегистрНакопления.Реализация.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК РеализацияОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ВременнаяВсяРеализация.СуммаПродажОбщая, 0) - ЕСТЬNULL(ВременнаяТаблицаДоотгрузка.СуммаДоотгрузки, 0) КАК СуммаПродажОбщая
	|ИЗ
	|	ВременнаяВсяРеализация КАК ВременнаяВсяРеализация,
	|	ВременнаяТаблицаДоотгрузка КАК ВременнаяТаблицаДоотгрузка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РеализацияОборотыОсвобожденные.ДоходОборот КАК СуммаПродажОсвобожденная
	|ИЗ
	|	РегистрНакопления.Реализация.Обороты(
	|			&НачалоМесяца,
	|			&КонецМесяца,
	|			,
	|			Организация = &Организация
	|				И СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Освобожденная)) КАК РеализацияОборотыОсвобожденные";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка);
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	Выборка = РезультатЗапроса[2].Выбрать();
	СуммаПродажОбщая = 0;
	Если Выборка.Следующий() Тогда
		СуммаПродажОбщая = Выборка.СуммаПродажОбщая;
	КонецЕсли;
	
	Выборка = РезультатЗапроса[3].Выбрать();
	СуммаПродажОсвобожденная = 0;
	Если Выборка.Следующий() Тогда
		СуммаПродажОсвобожденная = Выборка.СуммаПродажОсвобожденная;
	КонецЕсли;
	
	КоэффициентОсвобожденныхПоставок = 0;
	Если СуммаПродажОсвобожденная <> 0 ИЛИ СуммаПродажОсвобожденная <> 0 Тогда
		КоэффициентОсвобожденныхПоставок = Окр(СуммаПродажОсвобожденная / СуммаПродажОбщая, 4);		
	КонецЕсли;
	КоэффициентРаспределения = 1 - ?(КоэффициентОсвобожденныхПоставок < 0.05, 0, КоэффициентОсвобожденныхПоставок);
	
	// Строки 050 - 054
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	""050"" КАК Строка,
	|	""ОБЛАГАЕМЫЕ ПОСТАВКИ НА ТЕРРИТОРИИ КР"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(РеализацияОбороты.ДоходОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица050
	|ИЗ
	|	РегистрНакопления.Реализация.Обороты(
	|			&НачалоМесяца,
	|			&КонецМесяца,
	|			,
	|			Организация = &Организация
	|				И НЕ СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Освобожденная)
	|				И НЕ СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Нулевая)) КАК РеализацияОбороты
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеализацияИтоги КАК РеализацияИтоги
	|		ПО РеализацияИтоги.ДокументРеализации = РеализацияОбороты.ДокументРеализации
	|ГДЕ
	|	НЕ РеализацияИтоги.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Освобожденная)
	|	И РеализацияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.КР)
	|	И НЕ РеализацияИтоги.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Нулевая)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""051"" КАК Строка,
	|	""ПОСТАВКИ, ОБЛАГАЕМЫЕ ПО НУЛЕВОЙ СТАВКЕ"" КАК Содержание,
	|	СУММА(РеализацияОбороты.ДоходОборот) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица051
	|ИЗ
	|	РегистрНакопления.Реализация.Обороты(
	|			&НачалоМесяца,
	|			&КонецМесяца,
	|			,
	|			Организация = &Организация
	|				И СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Нулевая)) КАК РеализацияОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""052"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ В ЕВРАЗИЙСКИЙ ЭКОНОМИЧЕСКИЙ СОЮЗ"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(РеализацияОбороты.ДоходОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица052
	|ИЗ
	|	РегистрСведений.РеализацияИтоги КАК РеализацияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Реализация.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК РеализацияОбороты
	|		ПО РеализацияИтоги.ДокументРеализации = РеализацияОбороты.ДокументРеализации
	|ГДЕ
	|	РеализацияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.ЕАЭС)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""053"" КАК Строка,
	|	""ОСВОБОЖДЕННЫЕ И НЕОБЛАГАЕМЫЕ ПОСТАВКИ"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(РеализацияОбороты.ДоходОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица053
	|ИЗ
	|	РегистрСведений.РеализацияИтоги КАК РеализацияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Реализация.Обороты(
	|				&НачалоМесяца,
	|				&КонецМесяца,
	|				,
	|				Организация = &Организация
	|					И СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Освобожденная)) КАК РеализацияОбороты
	|		ПО РеализацияИтоги.ДокументРеализации = РеализацияОбороты.ДокументРеализации
	|ГДЕ
	|	РеализацияИтоги.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Освобожденная)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблица050.Сумма - ЕСТЬNULL(ВременнаяТаблицаДоотгрузка.СуммаДоотгрузки, 0) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица054
	|ИЗ
	|	ВременнаяТаблица050 КАК ВременнаяТаблица050,
	|	ВременнаяТаблицаДоотгрузка КАК ВременнаяТаблицаДоотгрузка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВременнаяТаблица051.Сумма
	|ИЗ
	|	ВременнаяТаблица051 КАК ВременнаяТаблица051
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВременнаяТаблица053.Сумма
	|ИЗ
	|	ВременнаяТаблица053 КАК ВременнаяТаблица053
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""050"" КАК Строка,
	|	""ОБЛАГАЕМЫЕ ПОСТАВКИ НА ТЕРРИТОРИИ КР"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица050.Сумма, 0) - ЕСТЬNULL(ВременнаяТаблицаДоотгрузка.СуммаДоотгрузки, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица050 КАК ВременнаяТаблица050,
	|	ВременнаяТаблицаДоотгрузка КАК ВременнаяТаблицаДоотгрузка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""051"" КАК Строка,
	|	""ПОСТАВКИ, ОБЛАГАЕМЫЕ ПО НУЛЕВОЙ СТАВКЕ"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица051.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица051 КАК ВременнаяТаблица051
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""052"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ В ЕВРАЗИЙСКИЙ ЭКОНОМИЧЕСКИЙ СОЮЗ"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица052.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица052 КАК ВременнаяТаблица052
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""053"" КАК Строка,
	|	""ОСВОБОЖДЕННЫЕ И НЕОБЛАГАЕМЫЕ ПОСТАВКИ"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица053.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица053 КАК ВременнаяТаблица053
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""054"" КАК Строка,
	|	""ОБЩАЯ СТОИМОСТЬ  ПОСТАВОК (=050+051+053)"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(ВременнаяТаблица054.Сумма, 0)) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица054 КАК ВременнаяТаблица054";	
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();	
	// 050
	Выборка = РезультатЗапроса[5].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);
	// 051
	Выборка = РезультатЗапроса[6].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);	
	// 052
	Выборка = РезультатЗапроса[7].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);	
	// 053
	Выборка = РезультатЗапроса[8].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);	
	// 054
	Выборка = РезультатЗапроса[9].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);	
												
	// Строки 055 - 058
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	""055"" КАК Строка,
	|	""ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ В КР"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаСебестоимостиОборот, 0) - ЕСТЬNULL(ПоступленияОбороты.СуммаНеоблагаемаяОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица055
	|ИЗ
	|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК ПоступленияОбороты
	|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
	|ГДЕ
	|	НЕ ПоступленияИтоги.ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаНДС.Импорт)
	|	И ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.КР)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""056а"" КАК Строка,
	|	""ИМПОРТ МАТЕРИАЛЬНЫХ РЕСУРСОВ В КР (только импорт)"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(НДСГТДИмпортОбороты.СуммаСебестоимостиОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица056
	|ИЗ
	|	РегистрНакопления.НДСГТДИмпорт.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК НДСГТДИмпортОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""057"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаСебестоимостиОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица057
	|ИЗ
	|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК ПоступленияОбороты
	|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
	|ГДЕ
	|	(ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.Импэкс)
	|			ИЛИ ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.ЕАЭС))
	|	И НЕ ПоступленияИтоги.ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаНДС.Импорт)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВременнаяТаблица055.Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица058
	|ИЗ
	|	ВременнаяТаблица055 КАК ВременнаяТаблица055
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВременнаяТаблица056.Сумма
	|ИЗ
	|	ВременнаяТаблица056 КАК ВременнаяТаблица056
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""055"" КАК Строка,
	|	""ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ В КР"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица055.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица055 КАК ВременнаяТаблица055
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""056"" КАК Строка,
	|	""ИМПОРТ МАТЕРИАЛЬНЫХ РЕСУРСОВ В КР"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(ВременнаяТаблица056.Сумма, 0)) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица056 КАК ВременнаяТаблица056
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""057"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица057.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица057 КАК ВременнаяТаблица057
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""058"" КАК Строка,
	|	""ОБЩАЯ СТОИМОСТЬ ПРИОБРЕТЕННЫХ МАТЕРИАЛЬНЫХ РЕСУРСОВ (=055+056)"" КАК Содержание,
	|	СУММА(ВременнаяТаблица058.Сумма) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица058 КАК ВременнаяТаблица058";
	
											
	РезультатЗапроса = Запрос.ВыполнитьПакет();	
	// 055
	Выборка = РезультатЗапроса[4].Выбрать();
	Выборка.Следующий();
	ПриобретениеКР 	= Выборка.Сумма;
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);
	
	// 056 - 057	
	Выборка = РезультатЗапроса[5].Выбрать();
	Выборка.Следующий();
	ТолькоИмпорт 		= Выборка.Сумма;
	СтрокаТабличнойЧасти056 = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти056, Выборка);
	
	Выборка = РезультатЗапроса[6].Выбрать();
	Выборка.Следующий();
	ИмпортЕАЭС 		= Выборка.Сумма;			
	СтрокаТабличнойЧасти057 = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти057, Выборка);
	
	ИмпортКР = ТолькоИмпорт + ИмпортЕАЭС;
	СтрокаТабличнойЧасти056.Сумма = ИмпортКР;
	
	// 058
	Выборка = РезультатЗапроса[7].Выбрать();
	Выборка.Следующий();
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);
	СтрокаТабличнойЧасти.Сумма = ПриобретениеКР + ИмпортКР;
	
	// 059, 065
	Запрос.Текст =
	"ВЫБРАТЬ
	|	""059"" КАК Строка,
	|	""ОБЩАЯ СУММА НДС ЗА ПРОИЗВЕДЕННЫЕ ПОСТАВКИ ( =050 х ставку / 100%)"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(РеализацияОбороты.СуммаНДСОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица059
	|ИЗ
	|	РегистрСведений.РеализацияИтоги КАК РеализацияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Реализация.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК РеализацияОбороты
	|		ПО РеализацияИтоги.ДокументРеализации = РеализацияОбороты.ДокументРеализации
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""065"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ,  ИСПОЛЬЗУЕМЫЕ ДЛЯ ПОСТАВОК С НУЛЕВОЙ СТАВКОЙ"" КАК Содержание,
	|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
	|ПОМЕСТИТЬ ВременнаяТаблица065
	|ИЗ
	|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
	|				&НачалоМесяца,
	|				&КонецМесяца,
	|				,
	|				Организация = &Организация
	|					И (ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.Зачет)
	|						ИЛИ ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.ПустаяСсылка))
	|					И СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.Нулевая)) КАК ПоступленияОбороты
	|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""059"" КАК Строка,
	|	""ОБЩАЯ СУММА НДС ЗА ПРОИЗВЕДЕННЫЕ ПОСТАВКИ ( =050 х ставку / 100%)"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица059.Сумма, 0) - ЕСТЬNULL(ВременнаяТаблицаДоотгрузка.СуммаНДСДоотгрузки, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица059 КАК ВременнаяТаблица059,
	|	ВременнаяТаблицаДоотгрузка КАК ВременнаяТаблицаДоотгрузка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""065"" КАК Строка,
	|	""В ТОМ ЧИСЛЕ НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ,  ИСПОЛЬЗУЕМЫЕ ДЛЯ ПОСТАВОК С НУЛЕВОЙ СТАВКОЙ"" КАК Содержание,
	|	ЕСТЬNULL(ВременнаяТаблица065.Сумма, 0) КАК Сумма
	|ИЗ
	|	ВременнаяТаблица065 КАК ВременнаяТаблица065";	
											
	РезультатЗапроса = Запрос.ВыполнитьПакет();	
	// 059
	Выборка = РезультатЗапроса[2].Выбрать();
	Выборка.Следующий();
	ВсегоНДСПоставки = Выборка.Сумма;
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка);	
	// 065 - Начало. Продолжение после 064
	Выборка065 = РезультатЗапроса[3].Выбрать();
	Выборка065.Следующий();	
	
	// Строки 060 - 063 
	Если УПП.УказыватьПризнакЗачетаНДСПриПоступлении Тогда
		Запрос.Текст = 
		
		"ВЫБРАТЬ
		|	""Распределение"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблицаРаспределение
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
		|				&НачалоМесяца,
		|				&КонецМесяца,
		|				,
		|				Организация = &Организация
		|					И ЗачетНДС = ЗНАЧЕНИЕ(Перечисление.ВидыЗачетаНДС.Распределение)) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""060"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица060
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
		|				&НачалоМесяца,
		|				&КонецМесяца,
		|				,
		|				Организация = &Организация
		|					И (ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.Зачет)
		|						ИЛИ ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.ПустаяСсылка))) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|ГДЕ
		|	ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.КР)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""061а"" КАК Строка,
		|	""НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ (только импорт)"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(НДСГТДИмпортОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица061
		|ИЗ
		|	РегистрНакопления.НДСГТДИмпорт.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК НДСГТДИмпортОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""062"" КАК Строка,
		|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица062
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
		|				&НачалоМесяца,
		|				&КонецМесяца,
		|				,
		|				Организация = &Организация
		|					И (ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.Зачет)
		|						ИЛИ ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.ПустаяСсылка))) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|ГДЕ
		|	(ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.Импэкс)
		|			ИЛИ ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.ЕАЭС))
		|	И НЕ ПоступленияИтоги.ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаНДС.Импорт)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""063"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, НЕ ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица063
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
		|				&НачалоМесяца,
		|				&КонецМесяца,
		|				,
		|				Организация = &Организация
		|					И ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.Себестоимость)) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""Распределение"" КАК Строка,
		|	ЕСТЬNULL(ВременнаяТаблицаРаспределение.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблицаРаспределение КАК ВременнаяТаблицаРаспределение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""060"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица060.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица060 КАК ВременнаяТаблица060
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""061"" КАК Строка,
		|	""НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ (только импорт)"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ВременнаяТаблица061.Сумма, 0)) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица061 КАК ВременнаяТаблица061
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""062"" КАК Строка,
		|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица062.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица062 КАК ВременнаяТаблица062
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""063"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, НЕ ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица063.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица063 КАК ВременнаяТаблица063";		
		
		РезультатЗапроса = Запрос.ВыполнитьПакет();	
		
		// Весь НДС на распределение
		Выборка = РезультатЗапроса[5].Выбрать();
		Распределение060 	= ?(Выборка.Следующий(), Выборка.Сумма, 0);
		НДСРаспределениеЗачет = Окр(Распределение060 * КоэффициентРаспределения, 2);
		
		МассивКоэффициентов = Новый Массив;
		// предварительно 060
		Выборка = РезультатЗапроса[6].Выбрать();
		НДСПоступленияКР = ?(Выборка.Следующий(), Выборка.Сумма, 0);
		МассивКоэффициентов.Добавить(НДСПоступленияКР);
		// предварительно 061 - только импорт, без ЕАЭС
		Выборка = РезультатЗапроса[7].Выбрать();
		НДСПоступленияТолькоИмпорт = ?(Выборка.Следующий(), Выборка.Сумма, 0);
		МассивКоэффициентов.Добавить(НДСПоступленияТолькоИмпорт);
		// предварительно 062 - только ЕАЭС
		Выборка = РезультатЗапроса[8].Выбрать();
		НДСПоступленияЕАЭС = ?(Выборка.Следующий(), Выборка.Сумма, 0);
		МассивКоэффициентов.Добавить(НДСПоступленияЕАЭС);
		// предварительно 063
		Выборка = РезультатЗапроса[9].Выбрать();
		НДССебестоимость = ?(Выборка.Следующий(), Выборка.Сумма, 0);
		
		
		МассивСуммРаспределения = ОбщегоНазначения.РаспределитьСуммуПропорциональноКоэффициентам(НДСРаспределениеЗачет, МассивКоэффициентов, 2);
		Распр_Приобретение 	= ?(МассивСуммРаспределения = Неопределено, 0, МассивСуммРаспределения[0]);		
		Распр_Импорт 		= ?(МассивСуммРаспределения = Неопределено, 0, МассивСуммРаспределения[1]);
		Распр_ЕАЭС 			= ?(МассивСуммРаспределения = Неопределено, 0, МассивСуммРаспределения[2]);
		
		НДСИмпорт	= 	НДСПоступленияТолькоИмпорт + Распр_Импорт + НДСПоступленияЕАЭС + Распр_ЕАЭС;
		
		// 060
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"060";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ";
		СтрокаТабличнойЧасти.Сумма 		= 	НДСПоступленияКР + Распр_Приобретение;
		НДС_060 = СтрокаТабличнойЧасти.Сумма;
		// 061
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"061";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ (только импорт)";
		СтрокаТабличнойЧасти.Сумма 	= 	НДСИмпорт;
		НДС_061 = СтрокаТабличнойЧасти.Сумма;
		// 062
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"062";		
		СтрокаТабличнойЧасти.Содержание = 	"В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА";
		СтрокаТабличнойЧасти.Сумма 	= 	НДСПоступленияЕАЭС + Распр_ЕАЭС;				
		// 063
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"063";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, НЕ ПОДЛЕЖАЩИЙ ЗАЧЕТУ";
		СтрокаТабличнойЧасти.Сумма 	= 	НДССебестоимость + Распределение060 - НДСРаспределениеЗачет;
		
	Иначе
		
		Запрос.Текст =
		"ВЫБРАТЬ
		|	""060"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	СУММА(ПоступленияОбороты.СуммаНДСОборот) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица060
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(&НачалоМесяца, &КонецМесяца, Месяц, Организация = &Организация) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|ГДЕ
		|	ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.КР)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""061а"" КАК Строка,
		|	""НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ (только импорт)"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(НДСГТДИмпортОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица062
		|ИЗ
		|	РегистрНакопления.НДСГТДИмпорт.Обороты(&НачалоМесяца, &КонецМесяца, , Организация = &Организация) КАК НДСГТДИмпортОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""062"" КАК Строка,
		|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
		|	СУММА(ЕСТЬNULL(ПоступленияОбороты.СуммаНДСОборот, 0)) КАК Сумма
		|ПОМЕСТИТЬ ВременнаяТаблица061
		|ИЗ
		|	РегистрСведений.ПоступленияИтоги КАК ПоступленияИтоги
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.Обороты(
		|				&НачалоМесяца,
		|				&КонецМесяца,
		|				,
		|				Организация = &Организация
		|					И (ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.Зачет)
		|						ИЛИ ЗачетНДС = ЗНАЧЕНИЕ(перечисление.ВидыЗачетаНДС.ПустаяСсылка))) КАК ПоступленияОбороты
		|		ПО ПоступленияИтоги.ДокументПоступления = ПоступленияОбороты.ДокументПоступления
		|ГДЕ
		|	(ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.Импэкс)
		|			ИЛИ ПоступленияИтоги.ПризнакСтраны = ЗНАЧЕНИЕ(Перечисление.ПризнакиСтраны.ЕАЭС))
		|	И НЕ ПоступленияИтоги.ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаНДС.Импорт)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""060"" КАК Строка,
		|	""НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица060.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица060 КАК ВременнаяТаблица060
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""061"" КАК Строка,
		|	""НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица061.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица061 КАК ВременнаяТаблица061
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	""062"" КАК Строка,
		|	""В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА"" КАК Содержание,
		|	ЕСТЬNULL(ВременнаяТаблица062.Сумма, 0) КАК Сумма
		|ИЗ
		|	ВременнаяТаблица062 КАК ВременнаяТаблица062";
		
		РезультатЗапроса = Запрос.ВыполнитьПакет();
		
		// 060
		Выборка = РезультатЗапроса[3].Выбрать();
		Если Выборка.Следующий() Тогда
			НДСПоступленияКР = Окр(Выборка.Сумма * КоэффициентРаспределения, 2);
			НДСКР_НеЗачет = Выборка.Сумма - НДСПоступленияКР;
		Иначе	
		    НДСПоступленияКР = 0;
			НДСКР_НеЗачет = 0;
		КонецЕсли;
		// 061
		Выборка = РезультатЗапроса[4].Выбрать();
		Если Выборка.Следующий() Тогда
			НДСПоступленияТолькоИмпорт = Окр(Выборка.Сумма * КоэффициентРаспределения, 2);
			НДСТолькоИмпорт_НеЗачет = Выборка.Сумма - НДСПоступленияТолькоИмпорт;
		Иначе
			НДСПоступленияТолькоИмпорт = 0;
			НДСТолькоИмпорт_НеЗачет = 0;
		КонецЕсли;
		// 062
		Выборка = РезультатЗапроса[5].Выбрать();
		Если Выборка.Следующий() Тогда
			НДСПоступленияЕАЭС = Окр(Выборка.Сумма * КоэффициентРаспределения, 2);
			НДСЕАЭС_НеЗачет = Выборка.Сумма - НДСПоступленияЕАЭС;
		Иначе
			НДСПоступленияЕАЭС = 0;
			НДСЕАЭС_НеЗачет = 0;
		КонецЕсли;		
		НДСИмпорт 		= НДСПоступленияТолькоИмпорт + НДСПоступленияЕАЭС;
		
		// 060
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"060";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ";
		СтрокаТабличнойЧасти.Сумма 		= 	НДСПоступленияКР;
		НДС_060 = СтрокаТабличнойЧасти.Сумма;
		// 061
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"061";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС НА ИМПОРТ, ПОДЛЕЖАЩИЙ ЗАЧЕТУ (только импорт)";
		СтрокаТабличнойЧасти.Сумма 		= 	НДСИмпорт;
		НДС_061 = СтрокаТабличнойЧасти.Сумма;
		
		// 062
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"062";		
		СтрокаТабличнойЧасти.Содержание = 	"В ТОМ ЧИСЛЕ ИЗ ЕВРАЗИЙСКОГО ЭКОНОМИЧЕСКОГО СОЮЗА";
		СтрокаТабличнойЧасти.Сумма 		= 	НДСПоступленияЕАЭС;		
		
		// 063
		СтрокаТабличнойЧасти = НДС.Добавить();
		СтрокаТабличнойЧасти.Строка 	= 	"063";		
		СтрокаТабличнойЧасти.Содержание = 	"НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, НЕ ПОДЛЕЖАЩИЙ ЗАЧЕТУ";
		СтрокаТабличнойЧасти.Сумма 		= 	НДСКР_НеЗачет + НДСТолькоИмпорт_НеЗачет + НДСЕАЭС_НеЗачет;		
		
	КонецЕсли;
											
	// 064
	НДС_064 = НДС_060 + НДС_061;
	СтрокаТабличнойЧасти = НДС.Добавить();
	СтрокаТабличнойЧасти.Строка 	= 	"064";		
	СтрокаТабличнойЧасти.Содержание = 	"ОБЩАЯ СУММА НДС ЗА ПРИОБРЕТЕННЫЕ МАТЕРИАЛЬНЫЕ РЕСУРСЫ, ПОДЛЕЖАЩАЯ ЗАЧЕТУ(=060+061)";
	СтрокаТабличнойЧасти.Сумма 		= 	НДС_064;
	
	// 065
	СтрокаТабличнойЧасти = НДС.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТабличнойЧасти, Выборка065);	
		
	// 066
    НДСЗачет = НДСПоступленияКР + НДСИмпорт;
	СтрокаТабличнойЧасти = НДС.Добавить();
	СтрокаТабличнойЧасти.Строка 	= 	"066";		
	СтрокаТабличнойЧасти.Содержание = 	"НАЛОГОВОЕ ОБЯЗАТЕЛЬСТВО (=059-064) (УКАЖИТЕ ЗНАК МИНУС, ЕСЛИ ЗНАЧЕНИЕ ОТРИЦАТЕЛЬНОЕ)";
	СтрокаТабличнойЧасти.Сумма 		= 	ВсегоНДСПоставки - НДС_064;	

КонецПроцедуры

// Процедура формирования движений по налогу на имущество
Процедура РассчитатьНалогНаИмущество() Экспорт 
	
	УчетМесяцев = Истина;
	// 1. Проверим заполнение оценочной стоимости в РС "Оценочная стоимость..."
	//Если ПроверкаЗаполненияСтоимостиМатериалСтен(КонецМесяца(Дата)) Тогда 
		
		// 2. Заполним недвижимость
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Имущество.ГруппаИмущества КАК ГруппаИмущества,
		|	Имущество.ОсновноеСредство КАК ОС,
		|	Имущество.МатериалСтен,
		|	Имущество.ДатаВводаВЭксплуатацию КАК ДатаВвода,
		|	Имущество.РегиональныйКоэффициент КАК Кр,
		|	Имущество.ЗональныйКоэффициент КАК Кз,
		|	Имущество.ОтраслевойКоэффициент КАК Ко,
		|	Имущество.ЖилаяПлощадь + Имущество.НежилаяПлощадь КАК Площадь,
		|	ГОД(&КонецМесяца) - ГОД(Имущество.ДатаВводаВЭксплуатацию) КАК ЛетЭксп,
		|	ВЫБОР
		|		КОГДА СостоянияОС.Период ЕСТЬ NULL 
		|			ТОГДА &Месяц
		|		ИНАЧЕ МЕСЯЦ(СостоянияОС.Период)
		|	КОНЕЦ КАК МесяцКон,
		|	ВЫБОР
		|		КОГДА Имущество.ДатаВводаВЭксплуатацию < &НачалоГода
		|			ТОГДА 0
		|		ИНАЧЕ МЕСЯЦ(Имущество.ДатаВводаВЭксплуатацию)
		|	КОНЕЦ КАК МесяцНач,
		|	ВЫБОР
		|		КОГДА НЕ СостоянияОС.Период ЕСТЬ NULL 
		|				И СостоянияОС.Период < &НачалоГода
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Выбыло,
		|	Имущество.ЖилаяПлощадь,
		|	Имущество.НежилаяПлощадь
		|ПОМЕСТИТЬ ВТИмущество
		|ИЗ
		|	РегистрСведений.СведенияОбИмуществе.СрезПоследних(
		|			&КонецМесяца,
		|			ГруппаИмущества <> ЗНАЧЕНИЕ(Справочник.ГруппыИмущества.ГИ4)
		|				И ДатаВводаВЭксплуатацию < &КонецМесяца
		|				И Регистратор.Организация = &Организация) КАК Имущество
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияОС.СрезПоследних(&КонецМесяца, Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)) КАК СостоянияОС
		|		ПО Имущество.ОсновноеСредство = СостоянияОС.ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РНЗемельныйНалогОбороты.ОсновноеСредство,
		|	РНЗемельныйНалогОбороты.СуммаЗемельногоНалогаПодОбъектомИмуществаОборот
		|ПОМЕСТИТЬ ВТЗемНалог
		|ИЗ
		|	РегистрНакопления.ЗемельныйНалог.Обороты(&НачалоГода, &КонецМесяца, , Организация = &Организация) КАК РНЗемельныйНалогОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТИмущество.ГруппаИмущества,
		|	ВТИмущество.ОС,
		|	ВТИмущество.МатериалСтен КАК МатериалСтен,
		|	ВТИмущество.ДатаВвода,
		|	ВТИмущество.Кр,
		|	ВТИмущество.Кз,
		|	ВТИмущество.Ко,
		|	ВТИмущество.Площадь,
		|	ВТИмущество.ЛетЭксп,
		|	ВТИмущество.МесяцКон,
		|	ВТИмущество.МесяцНач,
		|	ВТИмущество.Выбыло,
		|	ВЫБОР
		|		КОГДА ВТИмущество.ЛетЭксп >= ОценкаПоМатериалам.ОтЛет
		|				И (ВТИмущество.ЛетЭксп < ОценкаПоМатериалам.ДоЛет
		|					ИЛИ ОценкаПоМатериалам.ДоЛет = 0)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК НайденДиапазон,
		|	ОценкаПоМатериалам.Стоимость КАК ОценочнаяСтоимость,
		|	ОценкаПоМатериалам.ОтЛет,
		|	ОценкаПоМатериалам.ДоЛет,
		|	ВТИмущество.ЖилаяПлощадь,
		|	ВТИмущество.НежилаяПлощадь
		|ПОМЕСТИТЬ ВТСвод
		|ИЗ
		|	ВТИмущество КАК ВТИмущество
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ОценочнаяСтоимостьПоВидамМатериалов.СрезПоследних(&КонецМесяца, ) КАК ОценкаПоМатериалам
		|		ПО ВТИмущество.МатериалСтен = ОценкаПоМатериалам.МатериалСтен
		|ГДЕ
		|	НЕ ВТИмущество.Выбыло
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТСвод.ГруппаИмущества КАК ГруппаИмущества,
		|	ВТСвод.ОС КАК ОсновноеСредство,
		|	ВТСвод.МатериалСтен,
		|	ВТСвод.ДатаВвода,
		|	ВТСвод.Кр КАК КлассКр,
		|	ВТСвод.Кз КАК КлассКз,
		|	ВТСвод.Ко КАК КлассКо,
		|	ВТСвод.Площадь КАК ОбщаяПлощадь,
		|	ВТСвод.ЛетЭксп КАК СрокЭксплуатации,
		|	ВТСвод.МесяцКон - ВТСвод.МесяцНач КАК КоличествоМесяцев,
		|	ЕСТЬNULL(СтавкиНИ.Ставка, 0) КАК Ставка,
		|	ВТСвод.ОценочнаяСтоимость,
		|	ВТСвод.ОтЛет,
		|	ВТСвод.ДоЛет,
		|	ВТСвод.ЖилаяПлощадь,
		|	ВТСвод.НежилаяПлощадь,
		|	0 КАК СтоимостьНУ,
		|	0 КАК СуммаНалога,
		|	0 КАК НалогСУчетомЗемельногоНалога,
		|	0 КАК Кр,
		|	0 КАК Кз,
		|	0 КАК Ко,
		|	ЕСТЬNULL(ВТЗемНалог.СуммаЗемельногоНалогаПодОбъектомИмуществаОборот, 0) КАК ЗемНалог
		|ИЗ
		|	ВТСвод КАК ВТСвод
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиНалогаНаИмущество.СрезПоследних(&КонецМесяца, ) КАК СтавкиНИ
		|		ПО ВТСвод.ГруппаИмущества = СтавкиНИ.ГруппаНалогаНаИмущество
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗемНалог КАК ВТЗемНалог
		|		ПО ВТСвод.ОС = ВТЗемНалог.ОсновноеСредство
		|ГДЕ
		|	ВТСвод.НайденДиапазон
		|
		|УПОРЯДОЧИТЬ ПО
		|	ГруппаИмущества,
		|	ОсновноеСредство
		|АВТОУПОРЯДОЧИВАНИЕ";
		Запрос.УстановитьПараметр("Организация", 	Организация);			   
		Запрос.УстановитьПараметр("НачалоГода", 	НачалоГода(Дата));			   
		Запрос.УстановитьПараметр("КонецМесяца", 	КонецМесяца(Дата));			   
		Запрос.УстановитьПараметр("Месяц", 			Месяц(Дата));
		
		ТЗ = Запрос.Выполнить().Выгрузить();
		
		// 3. Рассчитаем налоговую стоимость и налог
		Для Каждого СТЧ Из ТЗ Цикл
			                                      
			ОтборКр = Новый Структура("Классификация", СТЧ.КлассКр);
			СтавкаКр = РегистрыСведений.КоэфицентыНалогаНаИмущество.ПолучитьПоследнее(Дата, ОтборКр).Коэфициент;
			
			ОтборКз = Новый Структура("Классификация", СТЧ.КлассКз);
			СтавкаКз = РегистрыСведений.КоэфицентыНалогаНаИмущество.ПолучитьПоследнее(Дата, ОтборКз).Коэфициент;
			
			ОтборКо = Новый Структура("Классификация", СТЧ.КлассКо);
			СтавкаКо = РегистрыСведений.КоэфицентыНалогаНаИмущество.ПолучитьПоследнее(Дата, ОтборКо).Коэфициент;
			
			СТЧ.Кр = СтавкаКр;
			СТЧ.Кз = СтавкаКз;
			СТЧ.Ко = СтавкаКо;
			
			
			СТЧ.СтоимостьНУ = Окр(СТЧ.ОбщаяПлощадь * СТЧ.ОценочнаяСтоимость * СТЧ.Кр * СТЧ.Кз * СТЧ.Ко * ?(УчетМесяцев, СТЧ.КоличествоМесяцев/Месяц(Дата), 1), 2);
			
			СТЧ.СуммаНалога	= Окр(СТЧ.СтоимостьНУ * СТЧ.Ставка/100, 2);
			
			СТЧ.НалогСУчетомЗемельногоНалога =  СТЧ.СуммаНалога - СТЧ.ЗемНалог;
			
		КонецЦикла;
		Недвижимость.Очистить();
		Недвижимость.Загрузить(ТЗ);	
	
	// 4. Сформируем транспорт
	//		1) ВТТранспорт: выбираем ОС группы 4, введенные в эксплуатацию до конца года, с подсчетом месяцев эксплуатации
	//		2) ВТСтоимость: выбираем балансовую стоимость для ОС категорий "Б" и "В" (Счет учета минус счет амортизации)
	//		3) ВТСвод, объединение:
	//			Выбираем из ВТ1 категорию "А" и соединяем ее со ставками
	//			Выбираем из ВТ1 категории Б и В (Не А) и соединяем с балансовой стоимостью 
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ХозрасчетныйВидыСубконто.Ссылка КАК СчетУчетаБУ
	|ПОМЕСТИТЬ ВТСчетаОС
	|ИЗ
	|	ПланСчетов.Хозрасчетный.ВидыСубконто КАК ХозрасчетныйВидыСубконто
	|ГДЕ
	|	ХозрасчетныйВидыСубконто.ВидСубконто = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Транспорт.Период,
	|	Транспорт.Регистратор,
	|	Транспорт.НомерСтроки,
	|	Транспорт.Активность,
	|	Транспорт.ОсновноеСредство КАК ОсновноеСредство,
	|	Транспорт.ДатаВводаВЭксплуатацию,
	|	Транспорт.ВидТранспорта,
	|	Транспорт.ОбъемДвигателя,
	|	Транспорт.ГруппаИмущества,
	|	ГОД(&КонецМесяца) - ГОД(Транспорт.ДатаВводаВЭксплуатацию) КАК ЛетЭксп,
	|	ВЫБОР
	|		КОГДА СостоянияОС.Период ЕСТЬ NULL 
	|			ТОГДА &Месяц
	|		ИНАЧЕ МЕСЯЦ(СостоянияОС.Период)
	|	КОНЕЦ КАК МесяцКон,
	|	ВЫБОР
	|		КОГДА Транспорт.ДатаВводаВЭксплуатацию < &НачалоГода
	|			ТОГДА 0
	|		ИНАЧЕ МЕСЯЦ(Транспорт.ДатаВводаВЭксплуатацию)
	|	КОНЕЦ КАК МесяцНач,
	|	ВЫБОР
	|		КОГДА НЕ СостоянияОС.Период ЕСТЬ NULL 
	|				И СостоянияОС.Период < &НачалоГода
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбыло,
	|	ВЫБОР
	|		КОГДА Транспорт.ВидТранспорта = ЗНАЧЕНИЕ(Справочник.ВидыТранспортаПоНалогуНаИмущество.Несамоходные)
	|			ТОГДА ""В""
	|		КОГДА Транспорт.ВидТранспорта = ЗНАЧЕНИЕ(Справочник.ВидыТранспортаПоНалогуНаИмущество.Другие)
	|			ТОГДА ""Б""
	|		ИНАЧЕ ""А""
	|	КОНЕЦ КАК АБВ
	|ПОМЕСТИТЬ ВТТранспорт
	|ИЗ
	|	РегистрСведений.СведенияОТранспорте.СрезПоследних(
	|			&КонецМесяца,
	|			ГруппаИмущества = ЗНАЧЕНИЕ(Справочник.ГруппыИмущества.ГИ4)
	|				И ДатаВводаВЭксплуатацию < &КонецМесяца
	|				И Регистратор.Организация = &Организация) КАК Транспорт
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияОС.СрезПоследних(
	|				&КонецМесяца,
	|				Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)
	|					И Организация = &Организация) КАК СостоянияОС
	|		ПО Транспорт.ОсновноеСредство = СостоянияОС.ОсновноеСредство
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТиповойОстатки.Субконто1 КАК ОсновноеСредство,
	|	СУММА(ТиповойОстатки.СуммаОстатокДт - ТиповойОстатки.СуммаОстатокКт) КАК БалансоваяСтоимость
	|ПОМЕСТИТЬ ВТСтоимость
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.Остатки(
	|			&КонецМесяца,
	|			Счет В
	|				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|					Счета.СчетУчетаБУ
	|				ИЗ
	|					ВТСчетаОС КАК Счета),
	|			ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства),
	|			Субконто1 В
	|					(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|						ВТТранспорт.ОсновноеСредство
	|					ИЗ
	|						ВТТранспорт КАК ВТТранспорт
	|					ГДЕ
	|						НЕ ВТТранспорт.Выбыло
	|						И ВТТранспорт.АБВ <> ""А"")
	|				И Организация = &Организация) КАК ТиповойОстатки
	|
	|СГРУППИРОВАТЬ ПО
	|	ТиповойОстатки.Субконто1
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТТранспорт.АБВ,
	|	ВТТранспорт.ОсновноеСредство,
	|	ВТТранспорт.ДатаВводаВЭксплуатацию,
	|	ВТТранспорт.ВидТранспорта,
	|	ВТТранспорт.ОбъемДвигателя,
	|	ВТТранспорт.ГруппаИмущества,
	|	ВТТранспорт.МесяцКон,
	|	ВТТранспорт.МесяцНач,
	|	ЕСТЬNULL(СтавкиА.Ставка, 0) КАК Ставка,
	|	ВЫБОР
	|		КОГДА ВТТранспорт.ЛетЭксп >= ЕСТЬNULL(СтавкиА.ОтЛет, 0)
	|				И (ВТТранспорт.ЛетЭксп < ЕСТЬNULL(СтавкиА.ДоЛет, 0)
	|					ИЛИ ЕСТЬNULL(СтавкиА.ДоЛет, 0) = 0)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК НайденДиапазон,
	|	ВТТранспорт.ЛетЭксп,
	|	ЕСТЬNULL(СтавкиА.ОтЛет, 0) КАК ОтЛет,
	|	ЕСТЬNULL(СтавкиА.ДоЛет, 0) КАК ДоЛет,
	|	ВТТранспорт.Регистратор,
	|	ВТТранспорт.Период
	|ПОМЕСТИТЬ ВТСвод
	|ИЗ
	|	ВТТранспорт КАК ВТТранспорт
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиНалогаНаТранспорт.СрезПоследних(&КонецМесяца, ) КАК СтавкиА
	|		ПО ВТТранспорт.ВидТранспорта = СтавкиА.ВидТранспорта
	|ГДЕ
	|	НЕ ВТТранспорт.Выбыло
	|	И ВТТранспорт.АБВ = ""А""
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТТранспорт.АБВ,
	|	ВТТранспорт.ОсновноеСредство,
	|	ВТТранспорт.ДатаВводаВЭксплуатацию,
	|	ВТТранспорт.ВидТранспорта,
	|	ЕСТЬNULL(ВТСтоимость.БалансоваяСтоимость, 0),
	|	ВТТранспорт.ГруппаИмущества,
	|	ВТТранспорт.МесяцКон,
	|	ВТТранспорт.МесяцНач,
	|	&Ставка,
	|	ИСТИНА,
	|	ВТТранспорт.ЛетЭксп,
	|	0,
	|	0,
	|	NULL,
	|	NULL
	|ИЗ
	|	ВТТранспорт КАК ВТТранспорт
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимость КАК ВТСтоимость
	|		ПО ВТТранспорт.ОсновноеСредство = ВТСтоимость.ОсновноеСредство
	|ГДЕ
	|	НЕ ВТТранспорт.Выбыло
	|	И ВТТранспорт.АБВ <> ""А""
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТСвод.АБВ КАК АБВ,
	|	ВТСвод.ОсновноеСредство КАК ОсновноеСредство,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ВТСвод.Регистратор) = ТИП(Документ.ПринятиеКУчетуОС)
	|			ТОГДА ВТСвод.Период
	|		ИНАЧЕ ВТСвод.ДатаВводаВЭксплуатацию
	|	КОНЕЦ КАК ДатаВводаВЭксплуатацию,
	|	ВТСвод.ВидТранспорта,
	|	ВТСвод.ОбъемДвигателя,
	|	ВТСвод.ГруппаИмущества,
	|	ВТСвод.МесяцКон - ВТСвод.МесяцНач КАК КоличествоМесяцев,
	|	ВТСвод.Ставка,
	|	ВТСвод.ЛетЭксп КАК СрокЭксплуатации,
	|	ВТСвод.ОтЛет,
	|	ВТСвод.ДоЛет,
	|	ВТСвод.Регистратор
	|ПОМЕСТИТЬ ВТИтог
	|ИЗ
	|	ВТСвод КАК ВТСвод
	|ГДЕ
	|	ВТСвод.НайденДиапазон
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТИтог.АБВ,
	|	ВТИтог.ОсновноеСредство,
	|	ВТИтог.ДатаВводаВЭксплуатацию,
	|	ВТИтог.ВидТранспорта,
	|	ВТИтог.ОбъемДвигателя,
	|	ВТИтог.ГруппаИмущества,
	|	ВЫБОР
	|		КОГДА ГОД(ВТИтог.ДатаВводаВЭксплуатацию) = ГОД(&КонецГода)
	|			ТОГДА МЕСЯЦ(&КонецГода) - МЕСЯЦ(ВТИтог.ДатаВводаВЭксплуатацию)
	|		ИНАЧЕ ВТИтог.КоличествоМесяцев
	|	КОНЕЦ КАК КоличествоМесяцев,
	|	ВТИтог.Ставка,
	|	ВТИтог.СрокЭксплуатации,
	|	ВТИтог.ОтЛет,
	|	ВТИтог.ДоЛет,
	|	ВТИтог.Регистратор
	|ИЗ
	|	ВТИтог КАК ВТИтог";
	
	Запрос.УстановитьПараметр("Организация", 	Организация);			   
	Запрос.УстановитьПараметр("НачалоГода", 	НачалоГода(Дата));			   
	Запрос.УстановитьПараметр("КонецМесяца", 	КонецМесяца(Дата));			   
	Запрос.УстановитьПараметр("Ставка", 		0.5);
	Запрос.УстановитьПараметр("Месяц", 			Месяц(Дата));
	Запрос.УстановитьПараметр("КонецГода",      КонецГода(КонецДня(Дата)));
	
	ТЗ = Запрос.Выполнить().Выгрузить();
	Транспорт.Очистить();
	Транспорт.Загрузить(ТЗ);
	
	СписокОС = Транспорт.ВыгрузитьКолонку("ОсновноеСредство");
	
	СчетаАмортизации = Новый СписокЗначений;
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.АмортизацияЗданияСооружения);
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияОборудование);
    СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияКонторскоеОборудование);
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияМебельИПринадлежности);
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияТранспортныеСредства);
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияБлагоустройствоАрендованнойСобственности);
	СчетаАмортизации.Добавить(ПланыСчетов.Хозрасчетный.НакопленнаяАмортизацияБлагоустройствоЗемльныхУчастков);

	СчетаОС = Новый СписокЗначений;
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.Земля);
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.ЗданияСооружения);
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.Оборудование);
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.КонторскоеОборудование);
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.МебельИПринадлежности);
	СчетаОС.Добавить(ПланыСчетов.Хозрасчетный.ТранспортныеСредстваЖДТранспорта);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ХозрасчетныйОстатки.Счет,
	|	ХозрасчетныйОстатки.Субконто1 КАК ОсновноеСредство,
	|	ХозрасчетныйОстатки.СуммаОстаток КАК ПервоначальнаяСтоимость
	|ПОМЕСТИТЬ ВТ_ПервоначальнаяСтоимость
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаСреза, счет В (&СчетаОС), ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства), Субконто1 В (&ОсновноеСредство)) КАК ХозрасчетныйОстатки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ХозрасчетныйОстаткиИОбороты.Счет,
	|	ХозрасчетныйОстаткиИОбороты.Субконто1 КАК ОсновноеСредство,
	|	ХозрасчетныйОстаткиИОбороты.СуммаКонечныйОстаток * -1 КАК НакопленыйИзнос
	|ПОМЕСТИТЬ ВТ_НакопленыйИзнос
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный.ОстаткиИОбороты(&ДатаН, &ДатаК, , Движения, Счет В (&СчетаАмортизации), ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОсновныеСредства), Субконто1 В (&ОсновноеСредство)) КАК ХозрасчетныйОстаткиИОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ПервоначальнаяСтоимость.ОсновноеСредство,
	|	ВТ_ПервоначальнаяСтоимость.ПервоначальнаяСтоимость,
	|	ЕСТЬNULL(ВТ_НакопленыйИзнос.НакопленыйИзнос, 0) КАК НакопленыйИзнос
	|ИЗ
	|	ВТ_ПервоначальнаяСтоимость КАК ВТ_ПервоначальнаяСтоимость
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_НакопленыйИзнос КАК ВТ_НакопленыйИзнос
	|		ПО ВТ_ПервоначальнаяСтоимость.ОсновноеСредство = ВТ_НакопленыйИзнос.ОсновноеСредство";
	
	Запрос.УстановитьПараметр("ДатаСреза",			КонецДня(Дата));
	Запрос.УстановитьПараметр("ДатаН",				НачалоМесяца(Дата));
	Запрос.УстановитьПараметр("ДатаК",				КонецМесяца(Дата));	
	Запрос.УстановитьПараметр("ОсновноеСредство",	СписокОС);	 
	Запрос.УстановитьПараметр("СчетаАмортизации",	СчетаАмортизации);	 
	Запрос.УстановитьПараметр("СчетаОС",			СчетаОС);	 
	
	ТЗРасчет = Запрос.Выполнить().Выгрузить();
	
	// 5. Рассчитаем налоговую стоимость и налог
	Для Каждого СТЧ Из Транспорт Цикл
		Если СТЧ.АБВ = "А" Тогда 
			СТЧ.СуммаНалога	= Окр(СТЧ.ОбъемДвигателя * СТЧ.Ставка * ?(УчетМесяцев, СТЧ.КоличествоМесяцев/Месяц(Дата), 1), 2);
		ИначеЕсли СТЧ.АБВ = "В"  Тогда
						
			СТЧРасчет = ТЗРасчет.Найти(СТЧ.ОС, "ОсновноеСредство");
			Если Не  СТЧРасчет = Неопределено Тогда 
				СуммаНалога  =	(СТЧРасчет.ПервоначальнаяСтоимость - СТЧРасчет.НакопленыйИзнос) / 100 * СТЧ.Ставка; 
				
				СТЧ.СуммаНалога = СуммаНалога;
			КонецЕсли;	
				
		Иначе 
			СТЧ.СуммаНалога	= Окр(СТЧ.ОбъемДвигателя * СТЧ.Ставка /100 * ?(УчетМесяцев, СТЧ.КоличествоМесяцев/Месяц(Дата), 1), 2);
		КонецЕсли;
		
		Если СТЧ.АБВ ="В" Тогда 
			СТЧ.ОбъемДвигателя = "0";
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Процедура - Выполнить закрытие временных счетов учета
//
Процедура ВыполнитьЗакрытиеВременныхСчетовУчета()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	Хозрасчетный.Ссылка,
		|	Хозрасчетный.Вид КАК ВидСчета,
		|	Хозрасчетный.Код КАК КодСчета
		|ПОМЕСТИТЬ ВременнаяТаблицаСчетаУчета
		|ИЗ
		|	ПланСчетов.Хозрасчетный КАК Хозрасчетный
		|ГДЕ
		|	Хозрасчетный.Временный
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет КАК СчетУчета,
		|	ХозрасчетныйОстатки.СуммаОстаток КАК СуммаДт,
		|	0 КАК СуммаКт,
		|	ВременнаяТаблицаСчетаУчета.КодСчета КАК КодСчета
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(
		|			&МоментВремени,
		|			Счет В
		|				(ВЫБРАТЬ
		|					ВременнаяТаблицаСчетаУчета.Ссылка
		|				ИЗ
		|					ВременнаяТаблицаСчетаУчета КАК ВременнаяТаблицаСчетаУчета
		|				ГДЕ
		|					ВременнаяТаблицаСчетаУчета.ВидСчета = ЗНАЧЕНИЕ(ВидСчета.Активный)),
		|			,
		|			Организация = &Организация) КАК ХозрасчетныйОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаСчетаУчета КАК ВременнаяТаблицаСчетаУчета
		|		ПО ХозрасчетныйОстатки.Счет = ВременнаяТаблицаСчетаУчета.Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет,
		|	0,
		|	ХозрасчетныйОстатки.СуммаОстаток * -1,
		|	ВременнаяТаблицаСчетаУчета.КодСчета
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(
		|			&МоментВремени,
		|			Счет В
		|				(ВЫБРАТЬ
		|					ВременнаяТаблицаСчетаУчета.Ссылка
		|				ИЗ
		|					ВременнаяТаблицаСчетаУчета КАК ВременнаяТаблицаСчетаУчета
		|				ГДЕ
		|					ВременнаяТаблицаСчетаУчета.ВидСчета = ЗНАЧЕНИЕ(ВидСчета.Пассивный)),
		|			,
		|			Организация = &Организация) КАК ХозрасчетныйОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаСчетаУчета КАК ВременнаяТаблицаСчетаУчета
		|		ПО ХозрасчетныйОстатки.Счет = ВременнаяТаблицаСчетаУчета.Ссылка
		|
		|УПОРЯДОЧИТЬ ПО
		|	КодСчета";
	Запрос = Новый Запрос(ТекстЗапроса);
	Запрос.УстановитьПараметр("МоментВремени", Дата + 1); 
	Запрос.УстановитьПараметр("Организация", Организация);
	
	ВременныеСчетаУчета.Загрузить(Запрос.Выполнить().Выгрузить())
	
КонецПроцедуры // РассчитатьПереоценкуВалютныхСредств()

// Процедура - Выполнить закрытие парных счетов учета
//
Процедура ВыполнитьЗакрытиеПарныхСчетовУчета()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	Хозрасчетный.Ссылка КАК АктивныйСчетУчета
		|ПОМЕСТИТЬ ВременнаяТаблицаСписокАктивныхПарныхСчетов
		|ИЗ
		|	ПланСчетов.Хозрасчетный КАК Хозрасчетный
		|ГДЕ
		|	Хозрасчетный.Вид = ЗНАЧЕНИЕ(ВидСчета.Активный)
		|	И НЕ Хозрасчетный.ПарныйСчет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)
		|	И Хозрасчетный.ВидыСубконто.ВидСубконто В(&ВидыСубконто)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВременнаяТаблицаСписокАктивныхПарныхСчетов.АктивныйСчетУчета.ПарныйСчет КАК ПассивныйСчетУчета
		|ПОМЕСТИТЬ ВременнаяТаблицаСписокПассивныхПарныхСчетов
		|ИЗ
		|	ВременнаяТаблицаСписокАктивныхПарныхСчетов КАК ВременнаяТаблицаСписокАктивныхПарныхСчетов
		|ГДЕ
		|	ВременнаяТаблицаСписокАктивныхПарныхСчетов.АктивныйСчетУчета.ПарныйСчет.Вид = ЗНАЧЕНИЕ(ВидСчета.Пассивный)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет КАК СчетАктивный,
		|	ХозрасчетныйОстатки.Субконто1 КАК Контрагент,
		|	ХозрасчетныйОстатки.Субконто2 КАК ДоговорКонтрагента,
		|	СУММА(ХозрасчетныйОстатки.СуммаОстаток) КАК СальдоАктивный,
		|	СУММА(ХозрасчетныйОстатки.ВалютнаяСуммаОстаток) КАК ВалютноеСальдоАктивный,
		|	ХозрасчетныйОстатки.Валюта КАК ВалютаАктивный
		|ПОМЕСТИТЬ ВременнаяТаблицаСальдоАктивныхСчетов
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(
		|			&МоментВремени,
		|			Счет В
		|				(ВЫБРАТЬ
		|					ВременнаяТаблицаСписокАктивныхПарныхСчетов.АктивныйСчетУчета
		|				ИЗ
		|					ВременнаяТаблицаСписокАктивныхПарныхСчетов КАК ВременнаяТаблицаСписокАктивныхПарныхСчетов),
		|			&ВидыСубконто,
		|			Организация = &Организация) КАК ХозрасчетныйОстатки
		|
		|СГРУППИРОВАТЬ ПО
		|	ХозрасчетныйОстатки.Счет,
		|	ХозрасчетныйОстатки.Субконто1,
		|	ХозрасчетныйОстатки.Субконто2,
		|	ХозрасчетныйОстатки.Валюта
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Счет КАК СчетПассивный,
		|	ХозрасчетныйОстатки.Субконто1 КАК Контрагент,
		|	ХозрасчетныйОстатки.Субконто2 КАК ДоговорКонтрагента,
		|	СУММА(ХозрасчетныйОстатки.СуммаОстаток) КАК СальдоПассивный,
		|	СУММА(ХозрасчетныйОстатки.ВалютнаяСуммаОстаток) КАК ВалютноеСальдоПассивный,
		|	ХозрасчетныйОстатки.Валюта КАК ВалютаПассивный
		|ПОМЕСТИТЬ ВременнаяТаблицаСальдоПассивныхСчетов
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(
		|			&МоментВремени,
		|			Счет В
		|				(ВЫБРАТЬ
		|					ВременнаяТаблицаСписокПассивныхПарныхСчетов.ПассивныйСчетУчета
		|				ИЗ
		|					ВременнаяТаблицаСписокПассивныхПарныхСчетов КАК ВременнаяТаблицаСписокПассивныхПарныхСчетов),
		|			&ВидыСубконто,
		|			Организация = &Организация) КАК ХозрасчетныйОстатки
		|
		|СГРУППИРОВАТЬ ПО
		|	ХозрасчетныйОстатки.Счет,
		|	ХозрасчетныйОстатки.Субконто1,
		|	ХозрасчетныйОстатки.Субконто2,
		|	ХозрасчетныйОстатки.Валюта
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВременнаяТаблицаСальдоАктивныхСчетов.СчетАктивный,
		|	ВременнаяТаблицаСальдоАктивныхСчетов.Контрагент,
		|	ВременнаяТаблицаСальдоАктивныхСчетов.ДоговорКонтрагента,
		|	СУММА(ВременнаяТаблицаСальдоАктивныхСчетов.СальдоАктивный) КАК СальдоАктивный,
		|	СУММА(ВременнаяТаблицаСальдоАктивныхСчетов.ВалютноеСальдоАктивный) КАК ВалютноеСальдоАктивный,
		|	ВременнаяТаблицаСальдоПассивныхСчетов.СчетПассивный,
		|	СУММА(ВременнаяТаблицаСальдоПассивныхСчетов.СальдоПассивный) КАК СальдоПассивный,
		|	СУММА(ВременнаяТаблицаСальдоПассивныхСчетов.ВалютноеСальдоПассивный) КАК ВалютноеСальдоПассивный,
		|	СУММА(ВременнаяТаблицаСальдоАктивныхСчетов.СальдоАктивный + ВременнаяТаблицаСальдоПассивныхСчетов.СальдоПассивный) КАК Разница
		|ПОМЕСТИТЬ ВременнаяТаблицаСальдоСводПарСчетов
		|ИЗ
		|	ВременнаяТаблицаСальдоАктивныхСчетов КАК ВременнаяТаблицаСальдоАктивныхСчетов
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВременнаяТаблицаСальдоПассивныхСчетов КАК ВременнаяТаблицаСальдоПассивныхСчетов
		|		ПО ВременнаяТаблицаСальдоАктивныхСчетов.Контрагент = ВременнаяТаблицаСальдоПассивныхСчетов.Контрагент
		|			И ВременнаяТаблицаСальдоАктивныхСчетов.ДоговорКонтрагента = ВременнаяТаблицаСальдоПассивныхСчетов.ДоговорКонтрагента
		|			И (ВременнаяТаблицаСальдоАктивныхСчетов.СальдоАктивный <> 0)
		|			И (ВременнаяТаблицаСальдоПассивныхСчетов.СальдоПассивный <> 0)
		|			И ВременнаяТаблицаСальдоАктивныхСчетов.СчетАктивный.ПарныйСчет = ВременнаяТаблицаСальдоПассивныхСчетов.СчетПассивный
		|
		|СГРУППИРОВАТЬ ПО
		|	ВременнаяТаблицаСальдоПассивныхСчетов.СчетПассивный,
		|	ВременнаяТаблицаСальдоАктивныхСчетов.Контрагент,
		|	ВременнаяТаблицаСальдоАктивныхСчетов.СчетАктивный,
		|	ВременнаяТаблицаСальдоАктивныхСчетов.ДоговорКонтрагента
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВременнаяТаблицаСальдоСводПарСчетов.СальдоАктивный,
		|	ВременнаяТаблицаСальдоСводПарСчетов.ВалютноеСальдоАктивный КАК СальдоАктивныйВалютное,
		|	ВременнаяТаблицаСальдоСводПарСчетов.СальдоПассивный,
		|	ВременнаяТаблицаСальдоСводПарСчетов.ВалютноеСальдоПассивный КАК СальдоПассивныйВалютное,
		|	ВременнаяТаблицаСальдоСводПарСчетов.СчетАктивный КАК СчетДт,
		|	ВременнаяТаблицаСальдоСводПарСчетов.СчетПассивный КАК СчетКт,
		|	ВременнаяТаблицаСальдоСводПарСчетов.Контрагент КАК Субконто1,
		|	ВременнаяТаблицаСальдоСводПарСчетов.ДоговорКонтрагента КАК Субконто2,
		|	НЕОПРЕДЕЛЕНО КАК Субконто3,
		|	ВЫБОР
		|		КОГДА ВременнаяТаблицаСальдоСводПарСчетов.Разница > 0
		|			ТОГДА ВременнаяТаблицаСальдоСводПарСчетов.СальдоПассивный
		|		КОГДА ВременнаяТаблицаСальдоСводПарСчетов.Разница < 0
		|			ТОГДА -ВременнаяТаблицаСальдоСводПарСчетов.СальдоАктивный
		|		ИНАЧЕ -ВременнаяТаблицаСальдоСводПарСчетов.СальдоАктивный
		|	КОНЕЦ КАК Сумма,
		|	ВЫРАЗИТЬ(ВременнаяТаблицаСальдоСводПарСчетов.ДоговорКонтрагента КАК Справочник.ДоговорыКонтрагентов).ВалютаРасчетов КАК Валюта,
		|	ВЫБОР
		|		КОГДА ВременнаяТаблицаСальдоСводПарСчетов.Разница > 0
		|			ТОГДА ВременнаяТаблицаСальдоСводПарСчетов.ВалютноеСальдоПассивный
		|		КОГДА ВременнаяТаблицаСальдоСводПарСчетов.Разница < 0
		|			ТОГДА -ВременнаяТаблицаСальдоСводПарСчетов.ВалютноеСальдоАктивный
		|		ИНАЧЕ -ВременнаяТаблицаСальдоСводПарСчетов.ВалютноеСальдоАктивный
		|	КОНЕЦ КАК ВалютнаяСумма
		|ИЗ
		|	ВременнаяТаблицаСальдоСводПарСчетов КАК ВременнаяТаблицаСальдоСводПарСчетов";
				
	ВидыСубконто = Новый Массив;
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Контрагенты);
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Договоры);
	
	Запрос = Новый Запрос(ТекстЗапроса);
	Запрос.УстановитьПараметр("МоментВремени", 	Дата + 1); 
	Запрос.УстановитьПараметр("Период", 		Дата);
	Запрос.УстановитьПараметр("Организация", 	Организация);
	Запрос.УстановитьПараметр("ВидыСубконто", 	ВидыСубконто);
	
	ПарныеСчетаУчета.Загрузить(Запрос.Выполнить().Выгрузить())
	
КонецПроцедуры // РассчитатьПереоценкуВалютныхСредств()

Процедура ПредварительныйКонтроль(Отказ)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗакрытиеМесяца.Ссылка
		|ИЗ
		|	Документ.ЗакрытиеМесяца КАК ЗакрытиеМесяца
		|ГДЕ
		|	НЕ ЗакрытиеМесяца.ПометкаУдаления
		|	И НЕ ЗакрытиеМесяца.Ссылка = &Ссылка
		|	И КОНЕЦПЕРИОДА(ЗакрытиеМесяца.Дата, МЕСЯЦ) = &Дата";
	
	Запрос.УстановитьПараметр("Дата", Дата);		
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Выборка = Запрос.Выполнить().Выбрать();
		
	Если Выборка.Количество() > 0 Тогда
		ТекстСообщения = НСтр("ru = 'Для указанного периода существует проведенный документ Закрытие месяца!'");
		БухгалтерскийУчетСервер.СообщитьОбОшибке(
			ЭтотОбъект,   
			ТекстСообщения,
			,
			,
			,
			Отказ);	    
	КонецЕсли;		

КонецПроцедуры

Функция ЕстьДокументВУказанныйПериод(Дата)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗакрытиеМесяца.Ссылка
		|ИЗ
		|	Документ.ЗакрытиеМесяца КАК ЗакрытиеМесяца
		|ГДЕ
		|	НЕ ЗакрытиеМесяца.ПометкаУдаления
		|	И КОНЕЦПЕРИОДА(ЗакрытиеМесяца.Дата, МЕСЯЦ) = &Дата";
	
	Запрос.УстановитьПараметр("Дата", Дата);		
	Выборка = Запрос.Выполнить().Выбрать();
	
	Возврат Выборка.Количество() > 0 	

КонецФункции 

Функция ПроверкаЗаполненияСтоимостиМатериалСтен(Дата) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СведенияОбИмуществе.МатериалСтен
	|ИЗ
	|	РегистрСведений.СведенияОбИмуществе.СрезПоследних(
	|			&Дата,
	|			(НЕ МатериалСтен В
	|					(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|						ОСВМ.МатериалСтен
	|					ИЗ
	|						РегистрСведений.ОценочнаяСтоимостьПоВидамМатериалов.СрезПоследних(&Дата) КАК ОСВМ))) КАК СведенияОбИмуществе";
	Запрос.УстановитьПараметр("Дата", КонецДня(Дата));
	ТЗ = Запрос.Выполнить().Выгрузить();
	Если ТЗ.Количество() <> 0 Тогда
		Для Каждого СТЗ Из ТЗ Цикл	 
			Сообщение = Новый СообщениеПользователю();
			Сообщение.Текст = СтрШаблон(НСтр("ru = 'Не указана оценочная стоимость для материала стен : ""%1""!'"), СТЗ.МатериалСтен);
			Сообщение.Сообщить();
		КонецЦикла;
		Возврат Ложь;
	Иначе
		Возврат Истина;		
	КонецЕсли;	
	
КонецФункции

#КонецОбласти

#Область ОбработчикиСобытий

// Процедура - обработчик события ОбработкаЗаполнения объекта.
//
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	ЗаполнениеОбъектов.ЗаполнитьДокумент(ЭтотОбъект, ДанныеЗаполнения);
	
	Если НЕ ЗначениеЗаполнено(Дата) Тогда
		Дата = КонецМесяца(ТекущаяДата());
		Если ЕстьДокументВУказанныйПериод(Дата) Тогда
			Дата = Дата('00010101');
		КонецЕсли;		
	КонецЕсли;
			
КонецПроцедуры

// Процедура - обработчик события ОбработкаПроведения объекта.
//
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	// Инициализация дополнительных свойств для проведения документа.
	БухгалтерскийУчетСервер.ИнициализироватьДополнительныеСвойстваДляПроведения(Ссылка, ДополнительныеСвойства);
	
	// Инициализация данных документа.
	Документы.ЗакрытиеМесяца.ИнициализироватьДанныеДокумента(Ссылка, ДополнительныеСвойства);
	
	// Подготовка наборов записей.
	БухгалтерскийУчетСервер.ПодготовитьНаборыЗаписейКРегистрацииДвижений(ЭтотОбъект);
	
	// Отражение в разделах учета.
	БухгалтерскийУчетСервер.ОтразитьХозрасчетный(ДополнительныеСвойства, Движения, Ложь);	
	БухгалтерскийУчетСервер.ОтразитьАвансыДоотгрузка(ДополнительныеСвойства,Движения,Ложь);	
	БухгалтерскийУчетСервер.ОтразитьСведенияПоНалогуНаимущество(ДополнительныеСвойства,Движения,Ложь);

	// Запись наборов записей.
	БухгалтерскийУчетСервер.ЗаписатьНаборыЗаписей(ЭтотОбъект);
	
	ДополнительныеСвойства.ДляПроведения.СтруктураВременныеТаблицы.МенеджерВременныхТаблиц.Закрыть();
	
КонецПроцедуры // ОбработкаПроведения()

// Процедура - обработчик события ОбработкаУдаленияПроведения объекта.
//
Процедура ОбработкаУдаленияПроведения(Отказ)
	
	// Инициализация дополнительных свойств для удаления проведения документа
	БухгалтерскийУчетСервер.ИнициализироватьДополнительныеСвойстваДляПроведения(Ссылка, ДополнительныеСвойства);
	
	// Подготовка наборов записей
	БухгалтерскийУчетСервер.ПодготовитьНаборыЗаписейКРегистрацииДвижений(ЭтотОбъект);
	
	// Запись наборов записей
	БухгалтерскийУчетСервер.ЗаписатьНаборыЗаписей(ЭтотОбъект);
		
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)		
	ПредварительныйКонтроль(Отказ);
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;

КонецПроцедуры

#КонецОбласти

#КонецЕсли